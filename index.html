<!DOCTYPE html>
<html lang="de">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Hangar Planner - Aircraft Management</title>
		<script src="https://cdn.tailwindcss.com"></script>
		<!-- PDF Export Library -->
		<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
		<script>
			// Robuste Tailwind-Konfiguration mit Fallback
			function configureTailwind() {
				if (typeof tailwind !== "undefined") {
					tailwind.config = {
						theme: {
							extend: {
								colors: {
									industrial: {
										dark: "#3A4354",
										medium: "#5D6B89",
										light: "#D1D5DB",
										accent: "#FF7043",
									},
									status: {
										green: "#22C55E",
										yellow: "#F59E0B",
										red: "#EF4444",
									},
								},
							},
						},
					};
					console.log("✅ Tailwind konfiguriert");
				} else {
					console.log("⚠️ Tailwind nicht verfügbar - verwende CSS-Variablen");
					// CSS-Variablen als Fallback setzen
					document.documentElement.style.setProperty(
						"--industrial-dark",
						"#3A4354"
					);
					document.documentElement.style.setProperty(
						"--industrial-medium",
						"#5D6B89"
					);
					document.documentElement.style.setProperty(
						"--industrial-accent",
						"#FF7043"
					);
				}
			}

			// Verwende zentrale Initialisierung statt separate DOMContentLoaded Events
			window.hangarInitQueue = window.hangarInitQueue || [];
			window.hangarInitQueue.push(function () {
				configureTailwind();
			});

			// Sofort-Konfiguration falls Tailwind bereits verfügbar
			if (typeof tailwind !== "undefined") {
				configureTailwind();
			}
		</script>
		<link rel="stylesheet" href="css/hangarplanner-ui.css" />
		<link rel="stylesheet" href="css/dark-mode-zoom.css" />
		<link rel="stylesheet" href="css/weather-widget.css" />
		<link rel="stylesheet" href="css/info-widget.css" />
		<link rel="stylesheet" href="css/flight-data-status.css" />
		<!-- Early apply saved dark mode to avoid flicker and ensure persistence -->
		<script>
			(function(){
				try {
					var isDark = false;
					try { var t = (localStorage.getItem('hangar.theme')||'').toLowerCase(); if (t==='dark') isDark = true; if (t==='light') isDark = false; } catch(e) {}
					if (!isDark) {
						var raw = localStorage.getItem('displayOptions');
						if (raw) {
							var parsed = JSON.parse(raw);
							if (parsed && parsed.darkMode) { isDark = true; }
						}
					}
					if (isDark) {
						// Apply dark-mode to <html> immediately so generic .dark-mode selectors take effect
						document.documentElement.classList.add('dark-mode');
						// Ensure body also has dark-mode when available
						var applyBody = function(){ if (document.body) document.body.classList.add('dark-mode'); };
						if (document.readyState === 'loading') {
							document.addEventListener('DOMContentLoaded', applyBody);
						} else {
							applyBody();
						}
					}
				} catch (e) {}
			})();
		</script>
		<!-- Neue separate CSS-Datei -->
		<style>
			.status-neutral {
				background-color: white;
				border: 1px solid #ccc;
			}

			.tow-neutral {
				background-color: white;
				color: #333333;
			}

			/* Inline unit suffix for inputs like the Update interval field */
			.input-with-suffix {
				position: relative;
			}
			.input-with-suffix .input-suffix {
				position: absolute;
				right: 10px;
				top: 50%;
				transform: translateY(-50%);
				color: #6b7280; /* subtle grey */
				font-size: 12px;
				pointer-events: none;
			}
			.input-with-suffix .has-suffix {
				padding-right: 70px; /* space for 'Minutes' */
			}

			/* Utility: force-hide header widgets from Display toggles */
			.hide-weather-widget #weather-widget { display: none !important; }
			.hide-time-widget #time-widget { display: none !important; }

			/* Small reminder icon next to Tow Status */
			.tow-badge {
				display: inline-block;
				margin-left: 6px;
				line-height: 1;
				vertical-align: middle;
			}
			.tow-badge svg {
				width: 14px;
				height: 14px;
				stroke: #ef4444; /* red */
				fill: none;
				stroke-width: 2;
				stroke-linecap: round;
				stroke-linejoin: round;
				display: inline-block;
				vertical-align: middle;
			}

			/* Header badge inside Tow Reminder widget */
			.reminder-active-badge {
				display: inline-block;
				font-size: 12px;
				font-weight: 600;
				background: none;
				border: none;
				padding: 0;
			}
			.reminder-active-badge.active { color: #0d9488; }
			.reminder-active-badge.inactive { color: #6b7280; }

			/* Ensure Tow Reminder matches other header widget fonts and stays on one row */
			#towing-reminder-widget .status-row {
				display: flex;
				flex-wrap: nowrap;
				align-items: center;
				white-space: nowrap;
			}
			/* Align Tow widget typography to Status widget; overdue list styled via class */
			#towing-reminder-widget .status-label { color: #3a4354; font-weight: 700; }
			#towing-reminder-widget .status-label-value { color: #64748b; font-weight: 600; margin-left: 8px; }
			/* Second row (list) always red */
			#towingReminderList { color: #ef4444 !important; font-weight: 700; }
			.dark-mode #towing-reminder-widget .status-label { color: var(--text-secondary); }
			.dark-mode #towing-reminder-widget .status-label-value { color: #cbd5e1; }
			.dark-mode #towingReminderList { color: #ef4444 !important; }
		</style>
	</head>
	<body class="bg-industrial-dark text-white font-sans edit-mode">
		<div class="flex h-screen">
			<!-- Neue linke Hauptnavigation -->
			<nav id="leftMenu" class="left-menu">
				<button class="menu-item" data-menu="project" title="Project">
					<svg class="menu-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
						<path stroke-linecap="round" stroke-linejoin="round" d="M3 6h14" />
						<path stroke-linecap="round" stroke-linejoin="round" d="M17 4v4" />
						<path stroke-linecap="round" stroke-linejoin="round" d="M3 12h18" />
						<path stroke-linecap="round" stroke-linejoin="round" d="M13 10v4" />
						<path stroke-linecap="round" stroke-linejoin="round" d="M3 18h10" />
						<path stroke-linecap="round" stroke-linejoin="round" d="M9 16v4" />
					</svg>
					<span class="menu-label">Project</span>
				</button>
				<button class="menu-item" data-menu="display" title="Display">
					<svg class="menu-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
						<path stroke-linecap="round" stroke-linejoin="round" d="M4 6h16v10H4z" />
						<path stroke-linecap="round" stroke-linejoin="round" d="M12 16v4" />
						<path stroke-linecap="round" stroke-linejoin="round" d="M8 20h8" />
					</svg>
					<span class="menu-label">Display</span>
				</button>
				<button class="menu-item" data-menu="sync" title="Sync">
					<svg class="menu-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
						<path stroke-linecap="round" stroke-linejoin="round" d="M3 12h18" />
						<path stroke-linecap="round" stroke-linejoin="round" d="M7 8l-4 4 4 4" />
						<path stroke-linecap="round" stroke-linejoin="round" d="M17 16l4-4-4-4" />
					</svg>
					<span class="menu-label">Sync</span>
				</button>
				<button class="menu-item" data-menu="update" title="Update">
					<svg class="menu-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
						<path stroke-linecap="round" stroke-linejoin="round" d="M4 4v6h6" />
						<path stroke-linecap="round" stroke-linejoin="round" d="M20 20v-6h-6" />
						<path stroke-linecap="round" stroke-linejoin="round" d="M5 20a9 9 0 0014-7" />
						<path stroke-linecap="round" stroke-linejoin="round" d="M19 4a9 9 0 00-14 7" />
					</svg>
					<span class="menu-label">Update</span>
				</button>
				<button class="menu-item" data-menu="export" title="Export">
					<svg class="menu-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
						<path stroke-linecap="round" stroke-linejoin="round" d="M12 3v12" />
						<path stroke-linecap="round" stroke-linejoin="round" d="M8 11l4 4 4-4" />
						<path stroke-linecap="round" stroke-linejoin="round" d="M4 21h16" />
					</svg>
					<span class="menu-label">Export</span>
				</button>
				<a href="timetable.html" class="menu-item" title="Timetable">
					<svg class="menu-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
						<path stroke-linecap="round" stroke-linejoin="round" d="M8 7V3m8 4V3M5 8h14M5 20h14a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
					</svg>
					<span class="menu-label">Timetable</span>
				</a>
				<a href="fleet-database.html" class="menu-item" title="Database">
					<svg class="menu-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
						<path stroke-linecap="round" stroke-linejoin="round" d="M4 7l8-3 8 3-8 3-8-3z" />
						<path stroke-linecap="round" stroke-linejoin="round" d="M4 12l8 3 8-3" />
						<path stroke-linecap="round" stroke-linejoin="round" d="M4 17l8 3 8-3" />
					</svg>
					<span class="menu-label">Database</span>
				</a>
			</nav>

			<!-- Click-blocking scrim for submenu drawer -->
			<div id="submenu-scrim" class="submenu-scrim hidden" aria-hidden="true"></div>

			<!-- Platzhalter für Submenus (werden im nächsten Schritt befüllt) -->
			<div id="submenu-update" class="submenu-panel hidden" data-for="update">
				<div class="submenu-title">Update</div>
				<div class="update-description">For scheduled update set time interval and activate</div>
				<div class="sidebar-form-group">
					<div class="sidebar-form-row">
						<label for="airportCodeInput">Airport IATA Code</label>
						<div class="input-container">
							<input type="text" id="airportCodeInput" name="airportCode" maxlength="3" value="MUC" class="sidebar-form-control" style="text-transform: uppercase;" />
						</div>
					</div>
				</div>
				<div class="sidebar-form-group">
					<div class="sidebar-form-row">
						<label for="currentDateInput">Arrival Date</label>
						<div class="input-container">
							<input type="date" id="currentDateInput" class="sidebar-form-control" />
						</div>
					</div>
				</div>
				<div class="sidebar-form-group">
					<div class="sidebar-form-row">
						<label for="updateIntervalInput">Time interval</label>
						<div class="input-container input-with-suffix">
							<input type="number" id="updateIntervalInput" class="sidebar-form-control has-suffix" min="1" value="15" placeholder="" title="Minutes" />
							<span class="input-suffix">Minutes</span>
						</div>
					</div>
				</div>
				<div class="sidebar-form-group">
					<div class="sidebar-form-row">
						<label for="scheduledUpdateToggle">Set active</label>
						<div class="input-container">
							<label class="modern-toggle-switch" aria-label="Scheduled Update Active">
								<input type="checkbox" id="scheduledUpdateToggle" />
								<span class="modern-toggle-slider"></span>
							</label>
						</div>
					</div>
				</div>
				<button id="fetchFlightData" class="sidebar-btn sidebar-btn-primary w-full">Update</button>
				<div class="text-sm text-center">Ready to update overnight flights</div>
				<div id="overnightFlightsStatus" class="text-sm text-center mt-2 p-2 rounded" style="background-color: #f0f9ff; border: 1px solid #0ea5e9; color: #0369a1; display: none;">
					<div class="font-semibold">Overnight Flights Processing</div>
					<div id="overnightFlightsMessage">Ready for overnight flight analysis</div>
				</div>
			</div>

				<div id="submenu-sync" class="submenu-panel hidden" data-for="sync">
					<div class="submenu-title">Sync Settings</div>
					<div class="sync-mode-description">Configure how your data syncs with the server</div>
					<div class="sync-toggle-row">
						<div class="sync-toggle-info">
							<div class="sync-toggle-title">Read Data</div>
							<div class="sync-toggle-desc">Receive updates from server</div>
						</div>
						<div class="sync-toggle-control">
							<label class="modern-toggle-switch" aria-label="Read Data">
								<input type="checkbox" id="readDataToggle" />
								<span class="modern-toggle-slider"></span>
							</label>
						</div>
					</div>
					<div class="sync-toggle-row">
						<div class="sync-toggle-info">
							<div class="sync-toggle-title">Write Data</div>
							<div class="sync-toggle-desc">Send changes to server (Master mode)</div>
						</div>
						<div class="sync-toggle-control">
							<label class="modern-toggle-switch" aria-label="Write Data">
								<input type="checkbox" id="writeDataToggle" />
								<span class="modern-toggle-slider"></span>
							</label>
						</div>
					</div>
					<div class="panel-divider"></div>
					<button id="manualSyncBtn" class="sidebar-btn sidebar-btn-primary w-full" title="Trigger a one-time sync now">Manual Sync</button>
					<div class="text-sm text-center" style="margin-top: 6px; color: #64748b;">Trigger a one-time sync now</div>
				</div>

			<div id="submenu-display" class="submenu-panel hidden" data-for="display">
				<div class="submenu-title">Display Settings</div>
				<div class="sidebar-form-group">
					<div class="sidebar-form-row">
						<label for="darkModeToggle">Darkmode</label>
						<div class="input-container">
							<div class="mode-toggle">
								<label class="toggle-switch">
									<input type="checkbox" id="darkModeToggle" />
									<span class="toggle-slider"></span>
								</label>
							</div>
						</div>
					</div>
				</div>
				<div class="sidebar-form-group">
					<div class="sidebar-form-row">
						<label for="viewModeToggle">Board/Row</label>
						<div class="input-container">
							<div class="mode-toggle">
								<label class="toggle-switch">
									<input type="checkbox" id="viewModeToggle" />
									<span class="toggle-slider"></span>
								</label>
							</div>
						</div>
					</div>
				</div>
					<!-- New toggles: Weather & Time widgets -->
					<div class="sidebar-form-group">
						<div class="sidebar-form-row">
							<label for="weatherWidgetToggle">Weather Widget</label>
							<div class="input-container">
								<div class="mode-toggle">
									<label class="toggle-switch">
										<input type="checkbox" id="weatherWidgetToggle" checked />
										<span class="toggle-slider"></span>
									</label>
								</div>
							</div>
						</div>
					</div>
					<div class="sidebar-form-group">
						<div class="sidebar-form-row">
							<label for="timeWidgetToggle">Time Widget</label>
							<div class="input-container">
								<div class="mode-toggle">
									<label class="toggle-switch">
										<input type="checkbox" id="timeWidgetToggle" checked />
										<span class="toggle-slider"></span>
									</label>
								</div>
							</div>
						</div>
					</div>
					<div class="sidebar-form-group">
						<div class="sidebar-form-row">
							<label for="tilesCount">Primary Tiles</label>
							<div class="input-container">
								<input type="number" id="tilesCount" min="1" max="12" class="sidebar-form-control" />
							</div>
						</div>
					</div>
					<div class="sidebar-form-group">
						<div class="sidebar-form-row">
							<label for="secondaryTilesCount">Secondary Tiles</label>
							<div class="input-container">
								<input type="number" id="secondaryTilesCount" min="0" max="12" class="sidebar-form-control" />
							</div>
						</div>
					</div>
					<div class="sidebar-form-group">
						<div class="sidebar-form-row">
							<label for="layoutType">Layout</label>
							<div class="input-container">
								<select id="layoutType" class="sidebar-form-select">
									<option value="1">1 Column</option>
									<option value="2">2 Columns</option>
									<option value="3">3 Columns</option>
									<option value="4" selected>4 Columns</option>
								</select>
							</div>
						</div>
					</div>

					<!-- Reset Screen control -->
					<div class="sidebar-form-group">
						<div class="sidebar-form-row">
							<label>Utilities</label>
							<div class="input-container">
								<button id="resetScreenBtn" class="sidebar-btn sidebar-btn-primary" title="Clear all tile inputs (except Hangar Position) and update timestamps">Reset screen</button>
							</div>
						</div>
					</div>
			</div>

			<div id="submenu-export" class="submenu-panel hidden" data-for="export">
				<div class="submenu-title">Export</div>
				<div class="sidebar-form-group">
					<label for="pdfFilename">File name:</label>
					<input type="text" id="pdfFilename" value="Hangar_Plan" class="sidebar-form-control" />
				</div>
				<div class="sidebar-form-group">
					<div class="flex items-center">
						<input type="checkbox" id="landscapeMode" checked class="mr-2" />
						<label for="landscapeMode">Landscape Mode</label>
					</div>
				</div>
				<div class="sidebar-form-group">
					<label class="sidebar-section-subtitle">Export Fields:</label>
					<div style="margin-left: 10px">
						<div class="flex items-center" style="margin-bottom: 5px">
							<input type="checkbox" id="exportAircraft" checked class="mr-2" />
							<label for="exportAircraft">Aircraft ID (AC-ID)</label>
						</div>
						<div class="flex items-center" style="margin-bottom: 5px">
							<input type="checkbox" id="exportArrival" checked class="mr-2" />
							<label for="exportArrival">Arrival Time (Arr)</label>
						</div>
						<div class="flex items-center" style="margin-bottom: 5px">
							<input type="checkbox" id="exportDeparture" checked class="mr-2" />
							<label for="exportDeparture">Departure Time (Dep)</label>
						</div>
						<div class="flex items-center" style="margin-bottom: 5px">
							<input type="checkbox" id="exportPosition" class="mr-2" />
							<label for="exportPosition">Position/Route (Pos)</label>
						</div>
						<div class="flex items-center" style="margin-bottom: 5px">
							<input type="checkbox" id="exportHangarPosition" checked class="mr-2" />
							<label for="exportHangarPosition">Hangar Position</label>
						</div>
						<div class="flex items-center" style="margin-bottom: 5px">
							<input type="checkbox" id="exportStatus" class="mr-2" />
							<label for="exportStatus">Status</label>
						</div>
						<div class="flex items-center" style="margin-bottom: 5px">
							<input type="checkbox" id="exportTowStatus" class="mr-2" />
							<label for="exportTowStatus">Tow Status</label>
						</div>
						<div class="flex items-center" style="margin-bottom: 5px">
							<input type="checkbox" id="exportNotes" class="mr-2" />
							<label for="exportNotes">Notes</label>
						</div>
					</div>
				</div>
				<button id="exportPdfBtn" class="sidebar-btn sidebar-btn-primary w-full">Export PDF</button>
			</div>

			<div id="submenu-project" class="submenu-panel hidden" data-for="project">
				<div class="submenu-title">Projekt Settings</div>
				<div class="sidebar-form-group">
					<div class="sidebar-form-row">
						<label for="modeToggle">View/Edit Mode:</label>
						<div class="input-container">
							<div class="mode-toggle">
								<span class="mode-toggle-label">View</span>
								<label class="toggle-switch" aria-label="View/Edit Mode">
									<input type="checkbox" id="modeToggle" checked />
									<span class="toggle-slider"></span>
								</label>
								<span class="mode-toggle-label">Edit</span>
							</div>
						</div>
					</div>
				</div>
				<div class="sidebar-form-group">
					<label for="projectName">Project Name:</label>
					<input id="projectName" type="text" placeholder="Project Name" class="sidebar-form-control" />
					<input type="hidden" id="projectId" value="" />
				</div>
				<div class="sidebar-input-group">
					<button id="saveBtn" class="sidebar-btn sidebar-btn-primary flex-1">Save</button>
					<button id="loadBtn" class="sidebar-btn sidebar-btn-secondary flex-1">Load</button>
				</div>
				<div class="panel-divider"></div>
				<div class="sync-mode-description">Configure how you want to be reminded for towing</div>

				<!-- Towing Reminder Settings -->
				<div class="sidebar-form-group">
					<div class="sidebar-form-row">
						<label for="towingReminderMinutesInput">Set Time to Reminder</label>
						<div class="input-container input-with-suffix">
							<input type="number" id="towingReminderMinutesInput" class="sidebar-form-control has-suffix" min="1" value="15" placeholder="" title="Minutes" />
							<span class="input-suffix">Minutes</span>
						</div>
					</div>
				</div>
				<div class="sidebar-form-group">
					<div class="sidebar-form-row">
						<label for="towingReminderToggle">Activate</label>
						<div class="input-container">
							<label class="modern-toggle-switch" aria-label="Towing Reminder Active">
								<input type="checkbox" id="towingReminderToggle" />
								<span class="modern-toggle-slider"></span>
							</label>
						</div>
					</div>
				</div>
			</div>

			<!-- Hauptbereich mit Hangar-Kacheln -->
			<div class="flex-grow flex flex-col content-container">
				<!-- Header mit Titel und Aktionen -->
					<header
						class="bg-white p-4 shadow-md flex justify-between gap-16">
						<!-- Wetter-Widget unverändert lassen -->
						<div class="flex-grow"></div>
						<div id="weather-widget">
							<div class="weather-primary">
								<div class="weather-airport">MUC</div>
								<div class="weather-data">
									<span id="weather-temp">12°C</span>
									<div id="weather-icon">
										<svg
											class="w-5 h-5"
											xmlns="http://www.w3.org/2000/svg"
											fill="none"
											viewBox="0 0 24 24"
											stroke="currentColor">
											<path
												stroke-linecap="round"
												stroke-linejoin="round"
												stroke-width="2"
												d="M3 15a4 4 0 004 4h9a5 5 0 10-.1-9.999 5.002 5.002 0 10-9.78 2.096A4.001 4.001 0 003 15z" />
										</svg>
									</div>
								</div>
							</div>
							<div class="weather-secondary">
								<span id="weather-wind" class="weather-wind-tooltip">
									<span class="weather-wind-icon" style="transform: rotate(0deg)">→</span>
									S 9 km/h
								</span>
								<span id="weather-description" class="weather-description-text">Clear</span>
								<span id="weather-visibility">Vis: 9.7km</span>
							</div>
						</div>

						<!-- Neuer Zeit-Widget: zwei Zeilen (UTC und LOC) -->
						<div id="time-widget">
							<div class="time-display-row">
								<span class="time-label">UTC:</span>
								<span id="utc-time" class="time-value">17:17</span>
							</div>
							<div class="time-display-row">
								<span class="time-label">LOC:</span>
								<span id="local-time" class="time-value">19:17</span>
							</div>
						</div>

						<!-- Tow Reminder Header Widget (between time and status) -->
						<div id="towing-reminder-widget">
							<div class="status-row" data-open-submenu="project" title="Open Project settings">
								<span class="status-label">Tow Reminder:</span>
								<span class="status-label-value">
									<span id="towingReminderActiveBadge" class="reminder-active-badge inactive">Inactive</span>
								</span>
							</div>
							<div class="status-row" data-open-submenu="project" title="Open Project settings">
								<span class="status-label"></span>
								<span class="status-label-value" id="towingReminderList"></span>
							</div>
						</div>

						<!-- Neuer Status-Widget: gebündelte Einstellungen -->
						<div id="status-widget">
							<!-- Row 1: Mode label only (no pill) -->
							<div class="status-row" data-open-submenu="sync" title="Open Sync settings">
								<span class="status-label">Mode:</span>
								<div class="status-value-group">
									<span id="sync-mode" class="status-label-value">Standalone</span>
								</div>
							</div>
							<!-- Row 2: Update status label from submenu settings (no pill) -->
							<div class="status-row" data-open-submenu="update" title="Open Update settings">
								<span class="status-label">Update:</span>
								<div class="status-value-group">
									<span id="headerUpdateStatus" class="status-label-value" title="Scheduled Update">Inactive</span>
									<span id="headerUpdateMeta" class="status-meta" title="Schedule details"></span>
								</div>
							</div>
							</div>


</header>

<!-- Header Status-Widget Initialisierung -->
<script>
(function(){
	function initHeaderStatusWidget(){
		const container = document.getElementById('status-widget');
		if(!container) return;

		// Öffne linke Submenüs bei Klick auf Status-Zeilen
		container.querySelectorAll('.status-row[data-open-submenu]').forEach(row => {
			row.addEventListener('click', () => {
				const key = row.getAttribute('data-open-submenu');
				const btn = document.querySelector(`#leftMenu .menu-item[data-menu="${key}"]`);
				if (btn) btn.click();
			});
		});

					// Update status label: open Update submenu on right-click
					const updateLabel = container.querySelector('#headerUpdateStatus');
					if (updateLabel) {
						const openUpdate = (e) => {
							if (e) { e.preventDefault(); e.stopPropagation(); }
							const btn = document.querySelector('#leftMenu .menu-item[data-menu="update"]');
							if (btn) btn.click();
						};
						updateLabel.addEventListener('contextmenu', openUpdate);
						updateLabel.addEventListener('click', openUpdate);
					}
					const updateMeta = container.querySelector('#headerUpdateMeta');
					if (updateMeta) {
						updateMeta.addEventListener('click', (e) => {
							e.preventDefault();
							e.stopPropagation();
							const btn = document.querySelector('#leftMenu .menu-item[data-menu="update"]');
							if (btn) btn.click();
						});
					}
					const syncLabel = container.querySelector('#sync-mode');
					if (syncLabel) {
						syncLabel.addEventListener('click', (e) => {
							e.preventDefault();
							e.stopPropagation();
							const btn = document.querySelector('#leftMenu .menu-item[data-menu="sync"]');
							if (btn) btn.click();
						});
					}

		// Update status label mirrors sidebar toggle state (read-only label)
		const updateStatusEl = document.getElementById('headerUpdateStatus');
		const sideToggle = document.getElementById('scheduledUpdateToggle');
		function updateHeaderUpdateStatus(){
			if (!updateStatusEl) return;
			const isActive = !!sideToggle?.checked;
			updateStatusEl.textContent = isActive ? 'Active' : 'Inactive';
			updateStatusEl.className = `status-label-value ${isActive ? 'active' : 'inactive'}`;
		}
		if (sideToggle) {
			updateHeaderUpdateStatus();
			sideToggle.addEventListener('change', updateHeaderUpdateStatus);
		}
		// Also reflect interval
		const intervalInput = document.getElementById('updateIntervalInput');
		function updateHeaderUpdateMeta(){
			const meta = document.getElementById('headerUpdateMeta');
			if (!meta) return;
			const minutes = parseInt(intervalInput?.value || '15', 10);
			meta.textContent = minutes ? `every ${minutes} min` : '';
		}
		if (intervalInput) {
			updateHeaderUpdateMeta();
			intervalInput.addEventListener('change', updateHeaderUpdateMeta);
		}

		// Optional coupling retained (no project label to update); guard for missing elements.
		let couplingInProgress = false;
		function updateProjectFromSync(){
			if (couplingInProgress) return;
			const readToggle = document.getElementById('readDataToggle');
			const writeToggle = document.getElementById('writeDataToggle');
			const read = !!(readToggle && readToggle.checked);
			const write = !!(writeToggle && writeToggle.checked);
			const isReadOnly = read && !write;
			const modeToggle = document.getElementById('modeToggle');
			if (modeToggle) {
				if (isReadOnly && modeToggle.checked) {
					couplingInProgress = true;
					modeToggle.checked = false; // View
					modeToggle.dispatchEvent(new Event('change', { bubbles: true }));
					couplingInProgress = false;
				} else if (!isReadOnly && !modeToggle.checked) {
					couplingInProgress = true;
					modeToggle.checked = true; // Edit
					modeToggle.dispatchEvent(new Event('change', { bubbles: true }));
					couplingInProgress = false;
				}
			}
		}
		function updateSyncFromProject(){
			if (couplingInProgress) return;
			const modeToggle = document.getElementById('modeToggle');
			if (!modeToggle) return;
			const wantEdit = !!modeToggle.checked;
			try {
				couplingInProgress = true;
				const readToggle = document.getElementById('readDataToggle');
				const writeToggle = document.getElementById('writeDataToggle');
				if (readToggle && writeToggle) {
					if (!wantEdit) {
						// View -> force read-only (read ON, write OFF)
						readToggle.checked = true;
						writeToggle.checked = false;
					} else {
						// Edit -> standalone (both OFF)
						readToggle.checked = false;
						writeToggle.checked = false;
					}
					// Dispatch change so sharing-manager updates state/UI
					readToggle.dispatchEvent(new Event('change', { bubbles: true }));
					writeToggle.dispatchEvent(new Event('change', { bubbles: true }));
				} else if (window.sharingManager && typeof window.sharingManager.enableSyncMode === 'function') {
					// Fallback if toggles not present: call manager directly
					if (!wantEdit) {
						window.sharingManager.enableSyncMode();
					} else if (typeof window.sharingManager.enableStandaloneMode === 'function') {
						window.sharingManager.enableStandaloneMode();
					}
				}
			} finally {
				couplingInProgress = false;
			}
		}
		const modeToggle = document.getElementById('modeToggle');
		if (modeToggle) modeToggle.addEventListener('change', updateSyncFromProject);
		const readToggle = document.getElementById('readDataToggle');
		const writeToggle = document.getElementById('writeDataToggle');
		if (readToggle) readToggle.addEventListener('change', updateProjectFromSync);
		if (writeToggle) writeToggle.addEventListener('change', updateProjectFromSync);
		updateProjectFromSync();
	}

	window.hangarInitQueue = window.hangarInitQueue || [];
							window.hangarInitQueue.push(initHeaderStatusWidget);
})();
</script>

<!-- Towing Reminder Logic (UTC-based time comparison) -->
<script>
(function(){
  const STORAGE_KEY = 'towingReminder';
  let timerId = null;

  // Persist one-time reminder flags per tile+aircraft to avoid duplicates
  const FLAGS_KEY = 'towingReminder.flags';
  function readFlags(){
    try { const raw = localStorage.getItem(FLAGS_KEY); return raw ? (JSON.parse(raw) || {}) : {}; } catch(e){ return {}; }
  }
  function saveFlags(flags){
    try { localStorage.setItem(FLAGS_KEY, JSON.stringify(flags || {})); } catch(e){}
  }
  function isTriggered(cellId, reg){
    if (!reg) return false;
    const flags = readFlags();
    return !!(flags && Object.prototype.hasOwnProperty.call(flags, cellId) && flags[cellId] === reg);
  }
  function markTriggered(entries){
    if (!entries || !entries.length) return;
    const flags = readFlags();
    let changed = false;
    entries.forEach(e => {
      if (!flags[e.cellId] || flags[e.cellId] !== e.reg){
        flags[e.cellId] = e.reg;
        changed = true;
      }
    });
    if (changed) saveFlags(flags);
  }
  function clearFlagForCell(cellId){
    const flags = readFlags();
    if (flags && Object.prototype.hasOwnProperty.call(flags, cellId)){
      delete flags[cellId];
      saveFlags(flags);
    }
  }

  function readConfig(){
    try {
      const raw = localStorage.getItem(STORAGE_KEY);
      if (raw){
        const cfg = JSON.parse(raw);
        const minutes = Math.max(1, parseInt(cfg.minutes||15,10)||15);
        const active = !!cfg.active;
        return { minutes, active };
      }
    } catch(e) { console.warn('towingReminder read failed', e); }
    return { minutes: 15, active: false };
  }
  function saveConfig(cfg){
    try { localStorage.setItem(STORAGE_KEY, JSON.stringify({ minutes: cfg.minutes, active: !!cfg.active })); } catch(e){}
  }
  function pad2(n){ return String(n).padStart(2,'0'); }
  // Parse ISO local (YYYY-MM-DDTHH:mm) as UTC epoch ms
  function parseISOAsUTC(iso){
    if (typeof iso !== 'string' || !/^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}$/.test(iso)) return NaN;
    const [date, time] = iso.split('T');
    const [y,m,d] = date.split('-').map(Number);
    const [hh,mm] = time.split(':').map(Number);
    return Date.UTC(y, (m||1)-1, d||1, hh||0, mm||0, 0, 0);
  }
  function getISOFromField(field, fieldId){
    const raw = (field?.dataset?.iso || field?.value || '').trim();
    if (raw && /^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}$/.test(raw)) return raw;
    if (window.helpers && typeof window.helpers.canonicalizeDateTimeFieldValue === 'function'){
      const iso = window.helpers.canonicalizeDateTimeFieldValue(fieldId, raw);
      if (iso && /^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}$/.test(iso)) return iso;
    }
    return '';
  }
  function formatHHmmUTC(ms){
    if (!isFinite(ms)) return '';
    const d = new Date(ms);
    return pad2(d.getUTCHours()) + ':' + pad2(d.getUTCMinutes());
  }
  function collectEligible(minutes){
    const nowMs = Date.now();
    const cutoffMs = nowMs + minutes * 60000; // include upcoming within window
    const result = [];
    document.querySelectorAll("select[id^='tow-status-']").forEach(sel => {
      if (!sel) return;
      const m = sel.id.match(/^tow-status-(\d+)$/);
      if (!m) return;
      const cellId = parseInt(m[1],10);
      if (sel.value !== 'on-position') return;
      const depField = document.getElementById(`departure-time-${cellId}`);
      if (!depField) return;
      const iso = getISOFromField(depField, `departure-time-${cellId}`);
      if (!iso) return;
      const depMs = parseISOAsUTC(iso);
      if (!isFinite(depMs)) return;
      if (depMs <= cutoffMs){
        const hangarPos = (document.getElementById(`hangar-position-${cellId}`)?.value || '').trim();
        result.push({ cellId, depMs, hhmm: formatHHmmUTC(depMs), hangarPos, overdue: depMs <= nowMs });
      }
    });
    result.sort((a,b)=> a.depMs - b.depMs);
    return result;
  }
  function ensureBadge(cellId, present){
    const sel = document.getElementById(`tow-status-${cellId}`);
    if (!sel) return;
    // Find existing indicator immediately after the select
    const sib = sel.nextElementSibling;
    const isDot = sib && sib.classList && sib.classList.contains('tow-dot');
    const isOld = sib && sib.classList && sib.classList.contains('tow-badge');
    if (present){
      if (isDot) return; // already correct
      if (isOld) { sib.remove(); }
      const dot = document.createElement('span');
      dot.className = 'tow-dot';
      dot.title = 'Tow reminder';
      sel.insertAdjacentElement('afterend', dot);
    } else {
      if (isDot || isOld) sib.remove();
    }
  }
  function updateBadges(eligible){
    const keep = new Set(eligible.map(x=>x.cellId));
    document.querySelectorAll("select[id^='tow-status-']").forEach(sel => {
      const m = sel.id.match(/^tow-status-(\d+)$/);
      if (!m) return;
      ensureBadge(parseInt(m[1],10), keep.has(parseInt(m[1],10)));
    });
  }
  function setWidgetVisibility(active){
    // Always visible; badge reflects active/inactive state
    const w = document.getElementById('towing-reminder-widget');
    if (!w) return;
    w.hidden = false;
    w.style.display = '';
    w.removeAttribute('hidden');
  }
  function updateActiveBadge(active){
    const b = document.getElementById('towingReminderActiveBadge');
    if (!b) return;
    b.hidden = false;
    b.style.display = 'inline-block';
    b.textContent = active ? 'Active' : 'Inactive';
    b.classList.remove('active','inactive');
    b.classList.add(active ? 'active' : 'inactive');
  }
  function renderHeader(overdueItems){
    const listEl = document.getElementById('towingReminderList');
    if (!listEl) return;
    const positions = (overdueItems || [])
      .map(x => (x.hangarPos || '').trim())
      .filter(Boolean);
    listEl.textContent = positions.join(', ');

    // Toggle styling for second-row presence
    const container = document.getElementById('towing-reminder-widget');
    if (container) {
      if (positions.length) {
        container.classList.add('has-second-row');
      } else {
        container.classList.remove('has-second-row');
      }
    }

    if (positions.length) {
      listEl.classList.add('tow-overdue');
    } else {
      listEl.classList.remove('tow-overdue');
    }
  }
  function runOnce(){
    const cfg = readConfig();
    setWidgetVisibility(cfg.active);
    updateActiveBadge(cfg.active);
    const eligibleAll = cfg.active ? collectEligible(cfg.minutes) : [];
    const overdueOnly = cfg.active ? eligibleAll.filter(x => x.overdue && x.hangarPos && x.hangarPos.length) : [];
    renderHeader(overdueOnly);
    updateBadges(eligibleAll);
  }
  function start(){
    stop();
    runOnce();
    timerId = setInterval(runOnce, 60*1000);
  }
  function stop(){
    if (timerId){ clearInterval(timerId); timerId = null; }
    renderHeader([]);
    updateBadges([]);
  }
  function initControls(){
    const minutesInput = document.getElementById('towingReminderMinutesInput');
    const toggle = document.getElementById('towingReminderToggle');
    const cfg = readConfig();
    if (minutesInput){
      minutesInput.value = cfg.minutes;
      let t = null;
      const apply = ()=>{
        let v = parseInt(minutesInput.value,10);
        if (!isFinite(v) || v < 1) v = 1;
        minutesInput.value = v;
        const newCfg = { minutes: v, active: !!(toggle && toggle.checked) };
        saveConfig(newCfg);
        if (newCfg.active) runOnce();
      };
      minutesInput.addEventListener('input', ()=>{ clearTimeout(t); t = setTimeout(apply, 200); });
      minutesInput.addEventListener('change', apply);
    }
    if (toggle){
      toggle.checked = !!cfg.active;
      toggle.addEventListener('change', ()=>{
        const minutes = parseInt(document.getElementById('towingReminderMinutesInput')?.value,10) || cfg.minutes || 15;
        const newCfg = { minutes, active: !!toggle.checked };
        saveConfig(newCfg);
        setWidgetVisibility(newCfg.active);
        updateActiveBadge(newCfg.active);
        if (newCfg.active) start(); else stop();
      });
    }
    setWidgetVisibility(cfg.active);
    updateActiveBadge(cfg.active);
    if (cfg.active) start(); else stop();

    // Reset one-time reminder flag only when user sets Tow Status away from "on-position"
    document.addEventListener('change', function(e){
      const el = e.target;
      if (el && el.matches("select[id^='tow-status-']")){
        const m = el.id.match(/^tow-status-(\d+)$/);
        if (m && el.value !== 'on-position'){
          clearFlagForCell(parseInt(m[1],10));
        }
      }
    });
  }
  function initHeaderWidget(){
    const container = document.getElementById('towing-reminder-widget');
    if (!container) return;
    container.querySelectorAll('.status-row').forEach(row => {
      row.addEventListener('click', () => {
        const btn = document.querySelector('#leftMenu .menu-item[data-menu="project"]');
        if (btn) btn.click();
      });
    });
  }
  window.hangarInitQueue = window.hangarInitQueue || [];
  window.hangarInitQueue.push(function(){
    try { initControls(); } catch(e){}
    try { initHeaderWidget(); } catch(e){}
  });
})();
</script>

				<!-- Enhanced submenu behavior for left rail (Step B) -->
				<script>
				(function(){
					const leftMenu = document.getElementById('leftMenu');
					if(!leftMenu) return;
					const scrim = document.getElementById('submenu-scrim');
					const panelNodes = document.querySelectorAll('.submenu-panel');
					const panels = {};
					panelNodes.forEach(p => { const k = p.getAttribute('data-for'); if(k) panels[k] = p; });
					const buttons = leftMenu.querySelectorAll('.menu-item[data-menu]');
					let current = null; // current open key
					let pinned = false;
					let closeTimer = null;

					function clearCloseTimer(){ if(closeTimer){ clearTimeout(closeTimer); closeTimer = null; } }
					function hideAll(){
						Object.values(panels).forEach(p=> p.classList.add('hidden'));
						buttons.forEach(btn=> { btn.classList.remove('active'); btn.setAttribute('aria-expanded','false'); });
						if (scrim) scrim.classList.add('hidden');
					}
					function show(key){
						if(!panels[key]) return;
						hideAll();
						panels[key].classList.remove('hidden');
						buttons.forEach(btn => { if(btn.getAttribute('data-menu')===key){ btn.classList.add('active'); btn.setAttribute('aria-expanded','true'); } });
						current = key;
					}
					function closeIfNotPinned(){ if(!pinned){ hideAll(); current = null; } }

					// Hover to preview (when not pinned)
					buttons.forEach(btn => {
						const key = btn.getAttribute('data-menu');
						btn.addEventListener('mouseenter', () => { if(!pinned){ clearCloseTimer(); show(key); } });
						btn.addEventListener('focus', () => { if(!pinned){ show(key); } });
						btn.addEventListener('click', (e) => {
							e.preventDefault();
							if(!pinned){
								pinned = true; show(key);
								if (scrim) scrim.classList.remove('hidden');
							}else{
								if(current === key){ // toggle off
									pinned = false; hideAll(); current = null;
								}else{ // switch pinned panel
									pinned = true; show(key);
									if (scrim) scrim.classList.remove('hidden');
								}
							}
						});
					});

					// Keep open while hovering panel
					Object.entries(panels).forEach(([key,panel]) => {
						panel.addEventListener('mouseenter', clearCloseTimer);
						panel.addEventListener('mouseleave', () => { if(!pinned){ closeTimer = setTimeout(() => closeIfNotPinned(), 150); } });
					});

					// Leaving menu when not pinned -> close after short delay unless entering panel
					leftMenu.addEventListener('mouseleave', () => { if(!pinned){ closeTimer = setTimeout(() => closeIfNotPinned(), 150); } });
					leftMenu.addEventListener('mouseenter', clearCloseTimer);

					// Click outside (or on scrim) always closes
					document.addEventListener('click', (e) => {
						const inMenu = leftMenu.contains(e.target);
						const inPanel = current && panels[current] && panels[current].contains(e.target);
						const clickedScrim = scrim && scrim.contains(e.target);
						if (clickedScrim) {
							pinned = false; hideAll(); current = null; return;
						}
						if(!inMenu && !inPanel){ pinned = false; hideAll(); current = null; }
					});

					// Explicit scrim handler
					if (scrim) {
						scrim.addEventListener('click', (e) => {
							e.stopPropagation();
							pinned = false; hideAll(); current = null;
						});
					}

					// ESC always closes and unpins
					document.addEventListener('keydown', (e) => {
						if(e.key === 'Escape'){
							pinned = false;
							hideAll();
							current = null;
						}
					});

					// Initialize ARIA
					buttons.forEach(btn => btn.setAttribute('aria-expanded','false'));
				})();
				</script>

				<div class="flex-grow bg-white p-3 overflow-auto hangar-container">
					<!-- Abschnitt 1 Container -->
					<div class="section-container">
						<div id="hangarGrid" class="grid grid-cols-4 gap-4">
							<!-- 8 Hangar-Kacheln hier -->
							<!-- Kachel 1 - NEU GESTALTET -->
							<div
								class="hangar-cell bg-white rounded-lg shadow-md flex flex-col">
								<!-- Header mit Statuslicht und Status-Dropdown -->
								<div class="card-header">
									<div class="header-elements">
										<!-- Statuslicht und Dropdown -->
										<div class="status-dropdown-container">
											<span
												class="status-light status-neutral"
												data-cell="1"
												data-status="neutral"></span>
											<select
												id="status-1"
												class="status-selector"
												title="Aircraft Status">
												<option value="neutral" selected></option>
												<option value="ready">Ready</option>
												<option value="maintenance">MX</option>
												<option value="aog">AOG</option>
											</select>
										</div>

										<!-- Position -->
										<div class="position-container">
											<input
												type="text"
												placeholder="1A"
												id="hangar-position-1"
												class="position-input"
												title="Hangar Position" />
										</div>
									</div>
								</div>

								<!-- Hauptbereich -->
								<div class="p-4 flex-grow flex flex-col">
									<input
										type="text"
										id="aircraft-1"
										placeholder="Aircraft ID"
										class="aircraft-id" />

									<!-- Einheitliche Ausrichtung für Infos -->
									<div class="info-grid mb-3">
										<div class="info-label">Arr:</div>
										<input
											type="datetime-local"
											id="arrival-time-1"
											class="info-input"
											title="Date/Time (UTC)"
											placeholder="dd.mm.yy,HH:mm" />

										<div class="info-label">Dep:</div>
										<input
											type="datetime-local"
											id="departure-time-1"
											class="info-input"
											title="Date/Time (UTC)"
											placeholder="dd.mm.yy,HH:mm" />

										<div class="info-label">Pos:</div>
										<input
											type="text"
											id="position-1"
											class="info-input"
											placeholder="--"
											maxlength="10"
											title="Aircraft position" />

										<div class="info-label">Tow:</div>
										<div class="tow-status-container">
											<select id="tow-status-1" class="tow-status-selector">
												<option value="neutral" selected></option>
												<option value="initiated" class="tow-initiated">
													Initiated
												</option>
												<option value="ongoing" class="tow-ongoing">
													In Progress
												</option>
												<option value="on-position" class="tow-on-position">
													On Position
												</option>
											</select>
										</div>
									</div>

									<!-- Notizen mit einer Zeile -->
									<div class="notes-container">
										<textarea
											id="notes-1"
											placeholder="Enter notes..."
											class="notes-textarea"></textarea>
									</div>
								</div>
							</div>

							<!-- Kachel 2 mit neuem Layout -->
							<div
								class="hangar-cell bg-white rounded-lg shadow-md flex flex-col">
								<!-- Header mit Statuslicht und Status-Dropdown -->
								<div class="card-header">
									<div class="header-elements">
										<!-- Statuslicht und Dropdown -->
										<div class="status-dropdown-container">
											<span
												class="status-light status-neutral"
												data-cell="2"
												data-status="neutral"></span>
											<select
												id="status-2"
												class="status-selector"
												title="Aircraft Status">
												<option value="neutral" selected></option>
												<option value="ready">Ready</option>
												<option value="maintenance">MX</option>
												<option value="aog">AOG</option>
											</select>
										</div>

										<!-- Position -->
										<div class="position-container">
											<input
												type="text"
												placeholder="1B"
												id="hangar-position-2"
												class="position-input"
												title="Hangar Position" />
										</div>
									</div>
								</div>

								<div class="p-4 flex-grow flex flex-col">
									<input
										type="text"
										id="aircraft-2"
										placeholder="Aircraft ID"
										class="aircraft-id" />

									<!-- Einheitliche Ausrichtung für Infos -->
									<div class="info-grid mb-3">
										<div class="info-label">Arr:</div>
										<input
											type="datetime-local"
											id="arrival-time-2"
											class="info-input"
											title="Date/Time (UTC)"
											placeholder="dd.mm.yy,HH:mm" />

										<div class="info-label">Dep:</div>
										<input
											type="datetime-local"
											id="departure-time-2"
											class="info-input"
											title="Date/Time (UTC)"
											placeholder="dd.mm.yy,HH:mm" />

										<div class="info-label">Pos:</div>
										<input
											type="text"
											id="position-2"
											class="info-input"
											placeholder="--"
											maxlength="10"
											title="Aircraft position" />

										<div class="info-label">Tow:</div>
										<div class="tow-status-container">
											<select id="tow-status-2" class="tow-status-selector">
												<option value="neutral" selected></option>
												<option value="initiated" class="tow-initiated">
													Initiated
												</option>
												<option value="ongoing" class="tow-ongoing">
													In Progress
												</option>
												<option value="on-position" class="tow-on-position">
													On Position
												</option>
											</select>
										</div>
									</div>

									<!-- Notizen mit einer Zeile -->
									<div class="notes-container">
										<textarea
											id="notes-2"
											placeholder="Enter notes..."
											class="notes-textarea"></textarea>
									</div>
								</div>
							</div>

							<!-- Kachel 3 mit neuem Layout -->
							<div
								class="hangar-cell bg-white rounded-lg shadow-md flex flex-col">
								<!-- Header mit Statuslicht und Status-Dropdown -->
								<div class="card-header">
									<div class="header-elements">
										<!-- Statuslicht und Dropdown -->
										<div class="status-dropdown-container">
											<span
												class="status-light status-neutral"
												data-cell="3"
												data-status="neutral"></span>
											<select
												id="status-3"
												class="status-selector"
												title="Aircraft Status">
												<option value="neutral" selected></option>
												<option value="ready">Ready</option>
												<option value="maintenance">MX</option>
												<option value="aog">AOG</option>
											</select>
										</div>

										<!-- Position -->
										<div class="position-container">
											<input
												type="text"
												placeholder="2A"
												id="hangar-position-3"
												class="position-input"
												title="Hangar Position" />
										</div>
									</div>
								</div>

								<div class="p-4 flex-grow flex flex-col">
									<input
										type="text"
										id="aircraft-3"
										placeholder="Aircraft ID"
										class="aircraft-id" />

									<!-- Einheitliche Ausrichtung für Infos -->
									<div class="info-grid mb-3">
										<div class="info-label">Arr:</div>
										<input
type="datetime-local"
											id="arrival-time-3"
											title="Date/Time (UTC)"
placeholder="dd.mm.yy,HH:mm"
											class="info-input"
											title="Time" />

										<div class="info-label">Dep:</div>
										<input
type="datetime-local"
											id="departure-time-3"
											title="Date/Time (UTC)"
         placeholder="dd.mm.yy,HH:mm"
											class="info-input"
											title="Time" />

										<div class="info-label">Pos:</div>
										<input
											type="text"
											id="position-3"
											class="info-input"
											placeholder="--"
											maxlength="10"
											title="Aircraft position" />

										<div class="info-label">Tow:</div>
										<div class="tow-status-container">
											<select id="tow-status-3" class="tow-status-selector">
												<option value="neutral" selected></option>
												<option value="initiated" class="tow-initiated">
													Initiated
												</option>
												<option value="ongoing" class="tow-ongoing">
													In Progress
												</option>
												<option value="on-position" class="tow-on-position">
													On Position
												</option>
											</select>
										</div>
									</div>

									<!-- Notizen mit einer Zeile -->
									<div class="notes-container">
										<textarea
											id="notes-3"
											placeholder="Enter notes..."
											class="notes-textarea"></textarea>
									</div>
								</div>
							</div>

							<!-- Kachel 4 mit neuem Layout + Notizfeld -->
							<div
								class="hangar-cell bg-white rounded-lg shadow-md flex flex-col">
								<!-- Header mit Statuslicht und Status-Dropdown -->
								<div class="card-header">
									<div class="header-elements">
										<!-- Statuslicht und Dropdown -->
										<div class="status-dropdown-container">
											<span
												class="status-light status-neutral"
												data-cell="4"
												data-status="neutral"></span>
											<select
												id="status-4"
												class="status-selector"
												title="Aircraft Status">
												<option value="neutral" selected></option>
												<option value="ready">Ready</option>
												<option value="maintenance">MX</option>
												<option value="aog">AOG</option>
											</select>
										</div>

										<!-- Position -->
										<div class="position-container">
											<input
												type="text"
												placeholder="2B"
												id="hangar-position-4"
												class="position-input"
												title="Hangar Position" />
										</div>
									</div>
								</div>

								<div class="p-4 flex-grow flex flex-col">
									<input
										type="text"
										id="aircraft-4"
										placeholder="Aircraft ID"
										class="aircraft-id" />

									<!-- Einheitliche Ausrichtung für Infos -->
									<div class="info-grid mb-3">
										<div class="info-label">Arr:</div>
										<input
type="datetime-local"
											id="arrival-time-4"
											title="Date/Time (UTC)"
											placeholder="dd.mm.yy,HH:mm"
											class="info-input"
											title="Time" />

										<div class="info-label">Dep:</div>
										<input
type="datetime-local"
											id="departure-time-4"
											title="Date/Time (UTC)"
											placeholder="dd.mm.yy,HH:mm"
											class="info-input"
											title="Time" />

										<div class="info-label">Pos:</div>
										<input
											type="text"
											id="position-4"
											class="info-input"
											placeholder="--"
											maxlength="10"
											title="Aircraft position" />

										<div class="info-label">Tow:</div>
										<div class="tow-status-container">
											<select id="tow-status-4" class="tow-status-selector">
												<option value="neutral" selected></option>
												<option value="initiated" class="tow-initiated">
													Initiated
												</option>
												<option value="ongoing" class="tow-ongoing">
													In Progress
												</option>
												<option value="on-position" class="tow-on-position">
													On Position
												</option>
											</select>
										</div>
									</div>

									<!-- Notizen mit einer Zeile -->
									<div class="notes-container">
										<textarea
											id="notes-4"
											placeholder="Enter notes..."
											class="notes-textarea"></textarea>
									</div>
								</div>
							</div>

							<!-- Kachel 5-8 mit dem gleichen optimierten Layout -->
							<!-- Kachel 5 -->
							<div
								class="hangar-cell bg-white rounded-lg shadow-md flex flex-col">
								<!-- Header mit Statuslicht und Status-Dropdown -->
								<div class="card-header">
									<div class="header-elements">
										<!-- Statuslicht und Dropdown -->
										<div class="status-dropdown-container">
											<span
												class="status-light status-neutral"
												data-cell="5"
												data-status="neutral"></span>
											<select
												id="status-5"
												class="status-selector"
												title="Aircraft Status">
												<option value="neutral" selected></option>
												<option value="ready">Ready</option>
												<option value="maintenance">MX</option>
												<option value="aog">AOG</option>
											</select>
										</div>

										<!-- Position -->
										<div class="position-container">
											<input
												type="text"
												placeholder="2C"
												id="hangar-position-5"
												class="position-input"
												title="Hangar Position" />
										</div>
									</div>
								</div>

								<!-- Hauptbereich mit Infos und Notizfeld -->
								<div class="p-4 flex-grow flex flex-col">
									<input
										type="text"
										id="aircraft-5"
										placeholder="Aircraft ID"
										class="aircraft-id" />

									<div class="info-grid mb-3">
										<div class="info-label">Arr:</div>
										<input
type="datetime-local"
											id="arrival-time-5"
											title="Date/Time (UTC)"
											placeholder="dd.mm.yy,HH:mm"
											class="info-input"
											title="Time" />
										<div class="info-label">Dep:</div>
										<input
type="datetime-local"
											id="departure-time-5"
											title="Date/Time (UTC)"
											placeholder="dd.mm.yy,HH:mm"
											class="info-input"
											title="Time" />
										<div class="info-label">Pos:</div>
										<input
											type="text"
											id="position-5"
											class="info-input"
											placeholder="--"
											maxlength="10"
											title="Aircraft position" />
										<div class="info-label">Tow:</div>
										<div class="tow-status-container">
											<select id="tow-status-5" class="tow-status-selector">
												<option value="neutral" selected></option>
												<option value="initiated" class="tow-initiated">
													Initiated
												</option>
												<option value="ongoing" class="tow-ongoing">
													In Progress
												</option>
												<option value="on-position" class="tow-on-position">
													On Position
												</option>
											</select>
										</div>
									</div>

									<!-- Notizfeld einzeilig -->
									<div class="notes-container">
										<textarea
											id="notes-5"
											placeholder="Enter notes..."
											class="notes-textarea"></textarea>
									</div>
								</div>
							</div>

							<!-- Kachel 6 mit neuem Design -->
							<div
								class="hangar-cell bg-white rounded-lg shadow-md flex flex-col">
								<!-- Header mit Statuslicht und Status-Dropdown -->
								<div class="card-header">
									<div class="header-elements">
										<!-- Statuslicht und Dropdown -->
										<div class="status-dropdown-container">
											<span
												class="status-light status-neutral"
												data-cell="6"
												data-status="neutral"></span>
											<select
												id="status-6"
												class="status-selector"
												title="Aircraft Status">
												<option value="neutral" selected></option>
												<option value="ready">Ready</option>
												<option value="maintenance">MX</option>
												<option value="aog">AOG</option>
											</select>
										</div>

										<!-- Position -->
										<div class="position-container">
											<input
												type="text"
												placeholder="3A"
												id="hangar-position-6"
												class="position-input"
												title="Hangar Position" />
										</div>
									</div>
								</div>

								<!-- Hauptbereich -->
								<div class="p-4 flex-grow flex flex-col">
									<input
										type="text"
										id="aircraft-6"
										placeholder="Aircraft ID"
										class="aircraft-id" />

									<div class="info-grid mb-3">
										<div class="info-label">Arr:</div>
										<input
type="datetime-local"
											id="arrival-time-6"
											title="Date/Time (UTC)"
											placeholder="dd.mm.yy,HH:mm"
											class="info-input"
											title="Time" />
										<div class="info-label">Dep:</div>
										<input
type="datetime-local"
											id="departure-time-6"
											title="Date/Time (UTC)"
											placeholder="dd.mm.yy,HH:mm"
											class="info-input"
											title="Time" />
										<div class="info-label">Pos:</div>
										<input
											type="text"
											id="position-6"
											class="info-input"
											placeholder="--"
											maxlength="10"
											title="Aircraft position" />
										<div class="info-label">Tow:</div>
										<div class="tow-status-container">
											<select id="tow-status-6" class="tow-status-selector">
												<option value="neutral" selected></option>
												<option value="initiated" class="tow-initiated">
													Initiated
												</option>
												<option value="ongoing" class="tow-ongoing">
													In Progress
												</option>
												<option value="on-position" class="tow-on-position">
													On Position
												</option>
											</select>
										</div>
									</div>

									<!-- Notizen einzeilig -->
									<div class="notes-container">
										<textarea
											id="notes-6"
											placeholder="Enter notes..."
											class="notes-textarea"></textarea>
									</div>
								</div>
							</div>

							<!-- Kachel 7 mit neuem Design -->
							<div
								class="hangar-cell bg-white rounded-lg shadow-md flex flex-col">
								<!-- Header mit Statuslicht und Status-Dropdown -->
								<div class="card-header">
									<div class="header-elements">
										<!-- Statuslicht und Dropdown -->
										<div class="status-dropdown-container">
											<span
												class="status-light status-neutral"
												data-cell="7"
												data-status="neutral"></span>
											<select
												id="status-7"
												class="status-selector"
												title="Aircraft Status">
												<option value="neutral" selected></option>
												<option value="ready">Ready</option>
												<option value="maintenance">MX</option>
												<option value="aog">AOG</option>
											</select>
										</div>

										<!-- Position -->
										<div class="position-container">
											<input
												type="text"
												placeholder="3B"
												id="hangar-position-7"
												class="position-input"
												title="Hangar Position" />
										</div>
									</div>
								</div>

								<!-- Hauptbereich -->
								<div class="p-4 flex-grow flex flex-col">
									<input
										type="text"
										id="aircraft-7"
										placeholder="Aircraft ID"
										class="aircraft-id" />

									<div class="info-grid mb-3">
										<div class="info-label">Arr:</div>
										<input
type="datetime-local"
											id="arrival-time-7"
											title="Date/Time (UTC)"
											placeholder="dd.mm.yy,HH:mm"
											class="info-input"
											title="Time" />
										<div class="info-label">Dep:</div>
										<input
type="datetime-local"
											id="departure-time-7"
											title="Date/Time (UTC)"
											placeholder="dd.mm.yy,HH:mm"
											class="info-input"
											title="Time" />
										<div class="info-label">Pos:</div>
										<input
											type="text"
											id="position-7"
											class="info-input"
											placeholder="--"
											maxlength="10"
											title="Aircraft position" />

										<div class="info-label">Tow:</div>
										<div class="tow-status-container">
											<select id="tow-status-7" class="tow-status-selector">
												<option value="neutral" selected></option>
												<option value="initiated" class="tow-initiated">
													Initiated
												</option>
												<option value="ongoing" class="tow-ongoing">
													In Progress
												</option>
												<option value="on-position" class="tow-on-position">
													On Position
												</option>
											</select>
										</div>
									</div>

									<!-- Notizen einzeilig -->
									<div class="notes-container">
										<textarea
											id="notes-7"
											placeholder="Enter notes..."
											class="notes-textarea"></textarea>
									</div>
								</div>
							</div>

							<!-- Kachel 8 mit neuem Design -->
							<div
								class="hangar-cell bg-white rounded-lg shadow-md flex flex-col">
								<!-- Header mit Statuslicht und Status-Dropdown -->
								<div class="card-header">
									<div class="header-elements">
										<!-- Statuslicht und Dropdown -->
										<div class="status-dropdown-container">
											<span
												class="status-light status-neutral"
												data-cell="8"
												data-status="neutral"></span>
											<select
												id="status-8"
												class="status-selector"
												title="Aircraft Status">
												<option value="neutral" selected></option>
												<option value="ready">Ready</option>
												<option value="maintenance">MX</option>
												<option value="aog">AOG</option>
											</select>
										</div>

										<!-- Position -->
										<div class="position-container">
											<input
												type="text"
												placeholder="4A"
												id="hangar-position-8"
												class="position-input"
												title="Hangar Position" />
										</div>
									</div>
								</div>

								<!-- Hauptbereich -->
								<div class="p-4 flex-grow flex flex-col">
									<input
										type="text"
										id="aircraft-8"
										placeholder="Aircraft ID"
										class="aircraft-id" />

									<div class="info-grid mb-3">
										<div class="info-label">Arr:</div>
										<input
type="datetime-local"
											id="arrival-time-8"
											title="Date/Time (UTC)"
											placeholder="dd.mm.yy,HH:mm"
											class="info-input"
											title="Time" />
										<div class="info-label">Dep:</div>
										<input
type="datetime-local"
											id="departure-time-8"
											title="Date/Time (UTC)"
											placeholder="dd.mm.yy,HH:mm"
											class="info-input"
											title="Time" />
										<div class="info-label">Pos:</div>
										<input
											type="text"
											id="position-8"
											class="info-input"
											placeholder="--"
											maxlength="10"
											title="Aircraft position" />
										<div class="info-label">Tow:</div>
										<div class="tow-status-container">
											<select id="tow-status-8" class="tow-status-selector">
												<option value="neutral" selected></option>
												<option value="initiated" class="tow-initiated">
													Initiated
												</option>
												<option value="ongoing" class="tow-ongoing">
													In Progress
												</option>
												<option value="on-position" class="tow-on-position">
													On Position
												</option>
											</select>
										</div>
									</div>

									<!-- Notizen einzeilig -->
									<div class="notes-container">
										<textarea
											id="notes-8"
											placeholder="Enter notes..."
											class="notes-textarea"></textarea>
									</div>
								</div>
							</div>

							<!-- Kachel 9 -->
							<div
								class="hangar-cell bg-white rounded-lg shadow-md flex flex-col">
								<!-- Header mit Statuslicht und Status-Dropdown -->
								<div class="card-header">
									<div class="header-elements">
										<!-- Statuslicht und Dropdown -->
										<div class="status-dropdown-container">
											<span
												class="status-light status-neutral"
												data-cell="9"
												data-status="neutral"></span>
											<select
												id="status-9"
												class="status-selector"
												title="Aircraft Status">
												<option value="neutral" selected></option>
												<option value="ready">Ready</option>
												<option value="maintenance">MX</option>
												<option value="aog">AOG</option>
											</select>
										</div>

										<!-- Position -->
										<div class="position-container">
											<input
												type="text"
												placeholder="3A"
												id="hangar-position-9"
												class="position-input"
												title="Hangar Position" />
										</div>
									</div>
								</div>

								<div class="p-4 flex-grow flex flex-col">
									<input
										type="text"
										id="aircraft-9"
										placeholder="Aircraft ID"
										class="aircraft-id" />

									<div class="info-grid mb-3">
										<div class="info-label">Arr:</div>
										<input
type="datetime-local"
											id="arrival-time-9"
											title="Date/Time (UTC)"
											placeholder="dd.mm.yy,HH:mm"
											class="info-input"
											title="Time" />
										<div class="info-label">Dep:</div>
										<input
type="datetime-local"
											id="departure-time-9"
											title="Date/Time (UTC)"
											placeholder="dd.mm.yy,HH:mm"
											class="info-input"
											title="Time" />
										<div class="info-label">Pos:</div>
										<input
											type="text"
											id="position-9"
											class="info-input"
											placeholder="--"
											maxlength="10"
											title="Aircraft position" />
										<div class="info-label">Tow:</div>
										<div class="tow-status-container">
											<select id="tow-status-9" class="tow-status-selector">
												<option value="neutral" selected></option>
												<option value="initiated" class="tow-initiated">
													Initiated
												</option>
												<option value="ongoing" class="tow-ongoing">
													In Progress
												</option>
												<option value="on-position" class="tow-on-position">
													On Position
												</option>
											</select>
										</div>
									</div>

									<div class="notes-container">
										<textarea
											id="notes-9"
											placeholder="Enter notes..."
											class="notes-textarea"></textarea>
									</div>
								</div>
							</div>

							<!-- Kachel 10 -->
							<div
								class="hangar-cell bg-white rounded-lg shadow-md flex flex-col">
								<!-- Header mit Statuslicht und Status-Dropdown -->
								<div class="card-header">
									<div class="header-elements">
										<!-- Statuslicht und Dropdown -->
										<div class="status-dropdown-container">
											<span
												class="status-light status-neutral"
												data-cell="10"
												data-status="neutral"></span>
											<select
												id="status-10"
												class="status-selector"
												title="Aircraft Status">
												<option value="neutral" selected></option>
												<option value="ready">Ready</option>
												<option value="maintenance">MX</option>
												<option value="aog">AOG</option>
											</select>
										</div>

										<!-- Position -->
										<div class="position-container">
											<input
												type="text"
												placeholder="3B"
												id="hangar-position-10"
												class="position-input"
												title="Hangar Position" />
										</div>
									</div>
								</div>

								<div class="p-4 flex-grow flex flex-col">
									<input
										type="text"
										id="aircraft-10"
										placeholder="Aircraft ID"
										class="aircraft-id" />

									<div class="info-grid mb-3">
										<div class="info-label">Arr:</div>
										<input
type="datetime-local"
											id="arrival-time-10"
											title="Date/Time (UTC)"
											placeholder="dd.mm.yy,HH:mm"
											class="info-input"
											title="Time" />
										<div class="info-label">Dep:</div>
										<input
type="datetime-local"
											id="departure-time-10"
											title="Date/Time (UTC)"
											placeholder="dd.mm.yy,HH:mm"
											class="info-input"
											title="Time" />
										<div class="info-label">Pos:</div>
										<input
											type="text"
											id="position-10"
											class="info-input"
											placeholder="--"
											maxlength="10"
											title="Aircraft position" />
										<div class="info-label">Tow:</div>
										<div class="tow-status-container">
											<select id="tow-status-10" class="tow-status-selector">
												<option value="neutral" selected></option>
												<option value="initiated" class="tow-initiated">
													Initiated
												</option>
												<option value="ongoing" class="tow-ongoing">
													In Progress
												</option>
												<option value="on-position" class="tow-on-position">
													On Position
												</option>
											</select>
										</div>
									</div>

									<div class="notes-container">
										<textarea
											id="notes-10"
											placeholder="Enter notes..."
											class="notes-textarea"></textarea>
									</div>
								</div>
							</div>

							<!-- Kachel 11 -->
							<div
								class="hangar-cell bg-white rounded-lg shadow-md flex flex-col">
								<!-- Header mit Statuslicht und Status-Dropdown -->
								<div class="card-header">
									<div class="header-elements">
										<!-- Statuslicht und Dropdown -->
										<div class="status-dropdown-container">
											<span
												class="status-light status-neutral"
												data-cell="11"
												data-status="neutral"></span>
											<select
												id="status-11"
												class="status-selector"
												title="Aircraft Status">
												<option value="neutral" selected></option>
												<option value="ready">Ready</option>
												<option value="maintenance">MX</option>
												<option value="aog">AOG</option>
											</select>
										</div>

										<!-- Position -->
										<div class="position-container">
											<input
												type="text"
												placeholder="3C"
												id="hangar-position-11"
												class="position-input"
												title="Hangar Position" />
										</div>
									</div>
								</div>

								<div class="p-4 flex-grow flex flex-col">
									<input
										type="text"
										id="aircraft-11"
										placeholder="Aircraft ID"
										class="aircraft-id" />

									<div class="info-grid mb-3">
										<div class="info-label">Arr:</div>
										<input
type="datetime-local"
											id="arrival-time-11"
											title="Date/Time (UTC)"
											placeholder="dd.mm.yy,HH:mm"
											class="info-input"
											title="Time" />
										<div class="info-label">Dep:</div>
										<input
type="datetime-local"
											id="departure-time-11"
											title="Date/Time (UTC)"
											placeholder="dd.mm.yy,HH:mm"
											class="info-input"
											title="Time" />

										<div class="info-label">Pos:</div>
										<input
											type="text"
											id="position-11"
											class="info-input"
											placeholder="--"
											maxlength="10"
											title="Aircraft position" />

										<div class="info-label">Tow:</div>
										<div class="tow-status-container">
											<select id="tow-status-11" class="tow-status-selector">
												<option value="neutral" selected></option>
												<option value="initiated" class="tow-initiated">
													Initiated
												</option>
												<option value="ongoing" class="tow-ongoing">
													In Progress
												</option>
												<option value="on-position" class="tow-on-position">
													On Position
												</option>
											</select>
										</div>
									</div>

									<div class="notes-container">
										<textarea
											id="notes-11"
											placeholder="Enter notes..."
											class="notes-textarea"></textarea>
									</div>
								</div>
							</div>

							<!-- Kachel 12 -->
							<div
								class="hangar-cell bg-white rounded-lg shadow-md flex flex-col">
								<!-- Header mit Statuslicht und Status-Dropdown -->
								<div class="card-header">
									<div class="header-elements">
										<!-- Statuslicht und Dropdown -->
										<div class="status-dropdown-container">
											<span
												class="status-light status-neutral"
												data-cell="12"
												data-status="neutral"></span>
											<select
												id="status-12"
												class="status-selector"
												title="Aircraft Status">
												<option value="neutral" selected></option>
												<option value="ready">Ready</option>
												<option value="maintenance">MX</option>
												<option value="aog">AOG</option>
											</select>
										</div>

										<!-- Position -->
										<div class="position-container">
											<input
												type="text"
												placeholder="3D"
												id="hangar-position-12"
												class="position-input"
												title="Hangar Position" />
										</div>
									</div>
								</div>

								<div class="p-4 flex-grow flex flex-col">
									<input
										type="text"
										id="aircraft-12"
										placeholder="Aircraft ID"
										class="aircraft-id" />

									<div class="info-grid mb-3">
										<div class="info-label">Arr:</div>
										<input
type="datetime-local"
											id="arrival-time-12"
											title="Date/Time (UTC)"
											placeholder="dd.mm.yy,HH:mm"
											class="info-input"
											title="Time" />
										<div class="info-label">Dep:</div>
										<input
type="datetime-local"
											id="departure-time-12"
											title="Date/Time (UTC)"
											placeholder="dd.mm.yy,HH:mm"
											class="info-input"
											title="Time" />

										<div class="info-label">Pos:</div>
										<input
											type="text"
											id="position-12"
											class="info-input"
											placeholder="--"
											maxlength="10"
											title="Aircraft position" />

										<div class="info-label">Tow:</div>
										<div class="tow-status-container">
											<select id="tow-status-12" class="tow-status-selector">
												<option value="neutral" selected></option>
												<option value="initiated" class="tow-initiated">
													Initiated
												</option>
												<option value="ongoing" class="tow-ongoing">
													In Progress
												</option>
												<option value="on-position" class="tow-on-position">
													On Position
												</option>
											</select>
										</div>
									</div>

									<div class="notes-container">
										<textarea
											id="notes-12"
											placeholder="Enter notes..."
											class="notes-textarea"></textarea>
									</div>
								</div>
							</div>
							<!-- Kachel 12 schließender div-Tag hinzugefügt -->
						</div>
					</div>

					<!-- Horizontale Trennlinie mit gleichmäßigem Abstand -->
					<div class="section-divider"></div>

					<!-- Abschnitt 2 Container -->
					<div class="section-container">
						<div id="secondaryHangarGrid" class="grid grid-cols-4 gap-4">
							<!-- Hier werden dynamisch weitere Kacheln eingefügt -->
						</div>
					</div>

				</div>
			</div>






				</div>

				<!-- Versteckte File-Input-Elemente -->
				<input type="file" id="jsonFileInput" accept=".json" class="hidden" />
				<input
					type="file"
					id="settingsFileInput"
					accept=".json"
					class="hidden" />
			</div>

			<!-- Modales Fenster für Laden -->
			<div
				id="loadModal"
				class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50">
				<div class="bg-industrial-medium rounded-lg p-6 w-96 max-w-full">
					<h2 class="text-xl font-bold mb-4">Load Hangar Plan</h2>
					<div class="mb-4">
						<input
							id="loadProjectName"
							type="text"
							placeholder="Enter Project Name"
							class="w-full bg-industrial-dark text-white px-3 py-2 rounded form-control" />
					</div>
					<div class="flex justify-end space-x-3">
						<button
							id="cancelLoad"
							class="px-4 py-2 bg-industrial-light text-industrial-dark rounded">
							Cancel
						</button>
						<button
							id="confirmLoad"
							class="px-4 py-2 bg-industrial-accent rounded">
							Load
						</button>
					</div>
				</div>
			</div>

			<!-- E-Mail-Erfolgsmeldung Modal -->
			<div
				id="emailSentModal"
				class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50">
				<div class="bg-industrial-medium rounded-lg p-6 w-96 max-w-full">
					<h2 class="text-xl font-bold mb-4">Email Sent</h2>
					<p class="mb-4">Your hangar plan has been sent successfully.</p>
					<div class="flex justify-end">
						<button
							id="emailOkBtn"
							class="px-4 py-2 bg-industrial-accent rounded">
							OK
						</button>
					</div>
				</div>
			</div>

			<!-- JavaScript-Dateien -->
			<script src="js/helpers.js"></script>
			<script src="js/global-initialization.js"></script>
			<script src="js/fileManager.js"></script>
			<script src="js/weather-api.js"></script>
			<script src="js/improved-event-manager.js"></script>
			<script src="js/hangar-ui.js"></script>
			<script src="js/hangar-data.js"></script>
			<script src="js/dynamic-api-loader.js"></script>
			<script src="js/aerodatabox-api.js"></script>
			<script src="js/goflightlabs-api.js"></script>
			<script src="js/airport-flights.js"></script>
			<script src="js/api-facade.js"></script>
			<script src="js/hangar-events.js"></script>
			<script src="js/hangar-pdf.js"></script>
			<script src="js/hangar.js"></script>
			<script src="js/storage-browser.js"></script>
			<script src="js/sharing-manager.js"></script>
			<script src="js/fleet-database-manager.js"></script>
			<script>
				// Ensure Sharing Manager initializes (binds sync toggles and manual sync button)
				window.hangarInitQueue = window.hangarInitQueue || [];
				window.hangarInitQueue.push(function(){
					try {
						if (window.sharingManager && !window.sharingManager.initialized) {
							window.sharingManager.init();
						}
					} catch (e) { console.warn('SharingManager init failed', e); }
				});
			</script>

			<!-- Timetable API Integration - NACH AeroDataBox API laden -->
			<script src="js/timetable-api-integration.js"></script>

			<!-- Debug-Script für API-Verfügbarkeit -->
			<script>
				// Debug-Funktion zur Überprüfung der API-Verfügbarkeit
				window.checkAPIs = function () {
					console.log("=== API VERFÜGBARKEITS-CHECK ===");
					console.log(
						"AeroDataBoxAPI:",
						typeof window.AeroDataBoxAPI !== "undefined"
							? "✅ Verfügbar"
							: "❌ Nicht verfügbar"
					);

					console.log(
						"FlightDataAPI:",
						typeof window.FlightDataAPI !== "undefined"
							? "✅ Verfügbar"
							: "❌ Nicht verfügbar"
					);

					return {
						aerodatabox: typeof window.AeroDataBoxAPI !== "undefined",
						aviationstack: typeof window.AviationstackAPI !== "undefined",
						facade: typeof window.FlightDataAPI !== "undefined",
					};
				};

				// Auto-Check nach dem Laden
				setTimeout(() => {
					console.log("🔍 Automatischer API-Check nach dem Laden:");
					window.checkAPIs();
				}, 1000);
			</script>


			<!-- Event-Handler für den "Info anzeigen"-Button -->
			<script>
				// Verwende zentrale Initialisierung statt separate DOMContentLoaded Events
				window.hangarInitQueue = window.hangarInitQueue || [];
				window.hangarInitQueue.push(function () {
					// Event-Handler für den Ordnerstruktur-Info-Button
					const showFolderInfoBtn =
						document.getElementById("showFolderInfoBtn");
					if (showFolderInfoBtn) {
						showFolderInfoBtn.addEventListener("click", function () {
							// Diese Funktion wird in folderManager.js definiert
							if (typeof window.folderManager !== "undefined") {
								window.folderManager.showFolderStructureInfo();
							} else {
								// Fallback, falls die Funktion nicht verfügbar ist
								alert(
									"Empfohlene Ordnerstruktur: HangarPlanner/Projekte/ für Projekte und HangarPlanner/Einstellungen/ für Einstellungen"
								);
							}
						});
					}

					// Initialisierung der UI, wenn Funktionen verfügbar sind
					if (typeof initializeUI === "function") {
						initializeUI();
					}

					if (typeof setupUIEventListeners === "function") {
						setupUIEventListeners();
					}
				});
			</script>

			<!-- Event-Handler für die neue Statusdarstellung -->
			<script>
				// Globale Funktion zum Aktualisieren des Statuslichts (für alle Kacheln)
				function updateStatusLight(select) {
					const cellId = select.id.split("-")[1];
					const statusValue = select.value;

					// Suche Status-Licht in primären ODER sekundären Kacheln
					let statusLight = document.querySelector(
						`.status-light[data-cell="${cellId}"]`
					);

					// Fallback: Suche in der nächsten Container-Hierarchie
					if (!statusLight) {
						const container = select.closest(".hangar-cell");
						if (container) {
							statusLight = container.querySelector(".status-light");
						}
					}

					if (statusLight) {
						// CSS-basierte Lösung: Nur data-status Attribut setzen
						statusLight.setAttribute("data-status", statusValue);
						statusLight.setAttribute("data-cell", cellId);

						// Legacy CSS-Klassen entfernen (für alte Browser)
						statusLight.classList.remove(
							"status-ready",
							"status-maintenance",
							"status-aog",
							"status-neutral"
						);
						// Neue CSS-Klasse hinzufügen (Fallback)
						statusLight.classList.add(`status-${statusValue}`);

						// console.log(`✅ Status-Licht für Kachel ${cellId} auf ${statusValue} gesetzt`);
					} else {
						console.warn(`❌ Status-Licht für Kachel ${cellId} nicht gefunden`);
					}
				}

				// Globale Funktion zum Aktualisieren ALLER Status-Lichter
				function updateAllStatusLights() {
					// console.log('🔄 Aktualisiere alle Status-Lichter...');
					const allStatusSelectors =
						document.querySelectorAll(".status-selector");
					let updated = 0;

					allStatusSelectors.forEach((select) => {
						if (select.value && select.value !== "neutral") {
							updateStatusLight(select);
							updated++;
						}
					});

					// console.log(`✅ ${updated} Status-Lichter aktualisiert`);
					return updated;
				}

				// NEUE FUNKTION: Aktualisiert Status-Lichter für alle Kacheln (auch leere)
				function updateAllStatusLightsForced() {
					console.log("🔄 Erzwinge Update aller Status-Lichter...");
					const allStatusSelectors =
						document.querySelectorAll(".status-selector");
					let updated = 0;

					allStatusSelectors.forEach((select) => {
						// Aktualisiere ALLE Status-Lichter, auch die mit "neutral" Wert
						updateStatusLight(select);
						updated++;
					});

					console.log(`✅ ${updated} Status-Lichter erzwungen aktualisiert`);
					return updated;
				}

				// Globale Funktion zum Aktualisieren eines spezifischen Status-Lichts nach Kachel-ID
				function updateStatusLightByCellId(cellId) {
					const statusSelect = document.getElementById(`status-${cellId}`);
					if (statusSelect) {
						updateStatusLight(statusSelect);
						return true;
					}
					return false;
				}

				// Verwende zentrale Initialisierung statt separate DOMContentLoaded Events
				window.hangarInitQueue = window.hangarInitQueue || [];

				// Mache Funktionen global verfügbar
				window.updateAllStatusLights = updateAllStatusLights;
				window.updateAllStatusLightsForced = updateAllStatusLightsForced;
				window.updateStatusLightByCellId = updateStatusLightByCellId;

				window.hangarInitQueue.push(function () {
					// Status-Dropdown-Handler für ALLE Kacheln (primäre UND sekundäre)
					function setupStatusHandlers() {
						document.querySelectorAll(".status-selector").forEach((select) => {
							// Prüfe ob Event-Listener bereits hinzugefügt wurde
							if (!select.hasAttribute("data-status-listener-added")) {
								// Initial Status setzen
								updateStatusLight(select);

								// Event-Listener für Änderungen
								select.addEventListener("change", function () {
									updateStatusLight(this);
								});

								// Markiere als verarbeitet
								select.setAttribute("data-status-listener-added", "true");
							}
						});
					}

					// Initial alle Status-Handler einrichten
					setupStatusHandlers();

					// Event-Listener für dynamisch erstellte sekundäre Kacheln
					document.addEventListener("secondaryTilesCreated", function (event) {
						// console.log('🎯 Sekundäre Kacheln erstellt, richte Status-Handler ein...');
						setTimeout(() => {
							setupStatusHandlers();
							// Erzwinge Update der Status-Lichter für sekundäre Kacheln
							updateAllStatusLightsForced();
						}, 100); // Kurze Verzögerung für DOM-Update
					});

					// Event-Listener für Daten-Updates (nach dem Laden von gespeicherten Daten)
					document.addEventListener("dataLoaded", function (event) {
						// console.log('📊 Daten geladen, aktualisiere alle Status-Lichter...');
						setTimeout(() => {
							updateAllStatusLightsForced(); // Erzwinge Update ALLER Lichter
						}, 200); // Verzögerung für DOM-Updates
					});
				});
			</script>

			<!-- Notizfelder in allen Kacheln auf Englisch ändern mit direktem DOM-Skript -->
			<script>
				// Verwende zentrale Initialisierung statt separate DOMContentLoaded Events
				window.hangarInitQueue = window.hangarInitQueue || [];
				window.hangarInitQueue.push(function () {
					// Alle Notizfelder auf Englisch umstellen
					document.querySelectorAll(".notes-textarea").forEach((textarea) => {
						if (
							textarea.getAttribute("placeholder") === "Notizen eingeben..." ||
							!textarea.getAttribute("placeholder")
						) {
							textarea.setAttribute("placeholder", "Enter notes...");
						}
					});

					// Status-Dropdowns Hintergrundfarbe forcieren
					document.querySelectorAll(".status-selector").forEach((select) => {
						select.style.backgroundColor = "#e6eaef";
					});
				});
			</script>

			<!-- Robustheitsskript für dynamisch erzeugte Elemente -->
			<script>
				// Zentrale Funktionen für UI-Updates
				function updateTextareasAndSelects() {
					// Alle Notizfelder auf Englisch umstellen
					document.querySelectorAll(".notes-textarea").forEach((textarea) => {
						if (
							textarea.getAttribute("placeholder") === "Notizen eingeben..." ||
							!textarea.getAttribute("placeholder")
						) {
							textarea.setAttribute("placeholder", "Enter notes...");
						}
					});

					// Status-Dropdowns Hintergrundfarbe forcieren
					document.querySelectorAll(".status-selector").forEach((select) => {
						select.style.backgroundColor = "#e6eaef";

						// Event-Listener für neue Status-Selektoren hinzufügen, falls noch nicht vorhanden
						if (!select.hasAttribute("data-listener-added")) {
							select.addEventListener("change", function () {
								updateStatusLight(this);
							});
							select.setAttribute("data-listener-added", "true");
							// Initial Status setzen
							updateStatusLight(select);
						}
					});
				}

				// Verwende zentrale Initialisierung
				window.hangarInitQueue = window.hangarInitQueue || [];
				window.hangarInitQueue.push(function () {
					// Sofort ausführen
					updateTextareasAndSelects();

					// Dann nochmal mit Verzögerungen
					setTimeout(updateTextareasAndSelects, 500);
					setTimeout(updateTextareasAndSelects, 1500);

					// Auch bei UI-Änderungen erneut ausführen
					document.addEventListener(
						"secondaryTilesCreated",
						updateTextareasAndSelects
					);
				});
			</script>

			<!-- Event-Handler für Aircraft ID Formatierung -->
			<script>
				// Zentrale Aircraft ID Formatierung
				function setupAircraftIdFormatting() {
					document
						.querySelectorAll('input[id^="aircraft-"]')
						.forEach((input) => {
							input.addEventListener("input", function (e) {
								formatAircraftId(e.target);
								// KORREKTUR: Aircraft ID Change Handler ENTFERNT vom input Event
								// API-Aufrufe sollen nur beim Verlassen des Feldes (blur) stattfinden
							});

							input.addEventListener("blur", function (e) {
								formatAircraftId(e.target);
								// KORREKTUR: Aircraft ID Change Handler NUR bei blur - API-Aufruf erst nach vollständiger Eingabe
								if (
									window.hangarEvents &&
									window.hangarEvents.handleAircraftIdChange
								) {
									window.hangarEvents.handleAircraftIdChange(
										e.target.id,
										e.target.value
									);
								}
							});
						});
				}

				// Formatierung: Erster Buchstabe + Bindestrich + Rest in Großbuchstaben
				function formatAircraftId(input) {
					let value = input.value.trim();
					if (value.length === 0) return;

					// Entferne alle Bindestriche und konvertiere zu Großbuchstaben
					let cleanValue = value.replace(/-/g, "").toUpperCase();

					if (cleanValue.length > 0) {
						// Erster Buchstabe + Bindestrich + Rest
						let formatted = cleanValue.charAt(0);
						if (cleanValue.length > 1) {
							formatted += "-" + cleanValue.substring(1);
						}

						input.value = formatted;
					}
				}
			</script>

			<!-- Event-Handler für Towing-Status Dropdowns -->
			<script>
				// Zentrale Towing-Status Verwaltung
				function setupTowStatusHandlers() {
					document
						.querySelectorAll(".tow-status-selector")
						.forEach((select) => {
							// Initial Status-Farbe setzen
							updateTowStatusStyles(select);

							// Event-Listener für Änderungen
							select.addEventListener("change", function () {
								updateTowStatusStyles(this);
							});
						});
				}

				// Funktion zum Aktualisieren der Towing-Status-Farben
				function updateTowStatusStyles(select) {
					// Alle Styling-Klassen entfernen
					select.classList.remove(
						"tow-neutral",
						"tow-initiated",
						"tow-ongoing",
						"tow-on-position"
					);

					// Neue Styling-Klasse basierend auf dem Wert hinzufügen
					const value = select.value;
					select.classList.add(`tow-${value}`);

					// Dark mode detection
					const isDarkMode = document.body.classList.contains('dark-mode');
					
					// Hintergrundfarbe und Textfarbe direkt setzen
					if (value === "neutral") {
						select.style.backgroundColor = "white";
						select.style.color = "#333333";
					} else if (value === "initiated") {
						if (isDarkMode) {
							select.style.backgroundColor = "#92400e"; // Dark mode: dunkleres Orange-Braun
							select.style.color = "#ffffff"; // Dark mode: weiße Schrift
						} else {
							select.style.backgroundColor = "#FEF3C7"; // Light mode: Hellgelb
							select.style.color = "#92400E";
						}
					} else if (value === "ongoing") {
						if (isDarkMode) {
							select.style.backgroundColor = "#1e40af"; // Dark mode: tieferes Blau
							select.style.color = "#ffffff"; // Dark mode: weiße Schrift
						} else {
							select.style.backgroundColor = "#DBEAFE"; // Light mode: Hellblau
							select.style.color = "#1E40AF";
						}
					} else if (value === "on-position") {
						if (isDarkMode) {
							select.style.backgroundColor = "#166534"; // Dark mode: dunkleres Grün
							select.style.color = "#ffffff"; // Dark mode: weiße Schrift
						} else {
							select.style.backgroundColor = "#D1FAE5"; // Light mode: Hellgrün
							select.style.color = "#065F46";
						}
					}
				}

				// Verwende zentrale Initialisierung
				window.hangarInitQueue = window.hangarInitQueue || [];
				window.hangarInitQueue.push(function () {
					// Initial ausführen
					setupTowStatusHandlers();

					// Aircraft ID Formatierung einrichten
					setupAircraftIdFormatting();

					// Auch bei UI-Updates ausführen
					document.addEventListener("secondaryTilesCreated", function () {
						setupTowStatusHandlers();
						setupAircraftIdFormatting();
					});

					// Mit Verzögerung nochmal ausführen, um dynamisch erstellte Elemente zu erfassen
					setTimeout(function () {
						setupTowStatusHandlers();
						setupAircraftIdFormatting();
					}, 500);
				});
			</script>

			<!-- Debug Script für Position-Klon-Problem -->
			<!-- OPTIMIERT: debug-position-clone.js entfernt -->

			<!-- Toast small utility -->
			<script src="js/toast.js"></script>

			<!-- Display Options Script -->
			<script src="js/display-options.js"></script>

			<!-- DEBUG: Uncomment for debugging Display Options -->
			<!-- <script src="js/debug/display-options-debug.js"></script> -->

			<!-- Zentrale Initialisierung - ersetzt alle separaten DOMContentLoaded Events -->
			<script>
				// Zentrale Initialisierungsqueue um Browser-Überlastung zu vermeiden
				window.hangarInitQueue = window.hangarInitQueue || [];

				// Einzelne zentrale Initialisierung statt 26 separate DOMContentLoaded Events
				document.addEventListener("DOMContentLoaded", function () {
					console.log("🚀 Starte zentrale Hangar-Initialisierung...");

					// Sequential execution statt parallel um Browser-Überlastung zu vermeiden
					let initIndex = 0;

					function executeNextInit() {
						if (initIndex < window.hangarInitQueue.length) {
							try {
								console.log(
									`📋 Führe Initialisierung ${initIndex + 1}/${
										window.hangarInitQueue.length
									} aus`
								);
								window.hangarInitQueue[initIndex]();
								initIndex++;
								// Kleine Verzögerung zwischen Initialisierungen um Browser zu entlasten
								setTimeout(executeNextInit, 10);
							} catch (error) {
								console.error(
									`❌ Fehler bei Initialisierung ${initIndex + 1}:`,
									error
								);
								initIndex++;
								setTimeout(executeNextInit, 10);
							}
						} else {
							console.log("✅ Zentrale Hangar-Initialisierung abgeschlossen");

							// FINAL: modeToggle Status korrigieren nach vollständiger Initialisierung
							setTimeout(() => {
								const modeToggle = document.getElementById("modeToggle");
								const body = document.body;
								if (modeToggle && body) {
									const isEditMode = body.classList.contains("edit-mode");
									modeToggle.checked = isEditMode;
									console.log(
										`🎛️ modeToggle Status korrigiert: ${
											isEditMode ? "Edit" : "View"
										}-Modus`
									);
								}
							}, 100);
						}
					}

					// Starte sequentielle Ausführung
					executeNextInit();
				});
			</script>

			<!-- Zeit-Update Script für Info Widget -->
			<script>
				// Zeit-Update Funktionen für Info Widget
				function updateTimeDisplay() {
					const now = new Date();

					// Lokale Zeit formatieren (ohne Sekunden)
					const localTime = now.toLocaleTimeString("de-DE", {
						hour: "2-digit",
						minute: "2-digit",
					});

					// UTC Zeit formatieren (ohne Sekunden)
					const utcTime = now.toUTCString().split(" ")[4].substring(0, 5); // Extrahiere HH:MM

					// DOM Elemente aktualisieren
					const localTimeElement = document.getElementById("local-time");
					const utcTimeElement = document.getElementById("utc-time");

					if (localTimeElement) {
						localTimeElement.textContent = localTime;
					}

					if (utcTimeElement) {
						utcTimeElement.textContent = utcTime;
					}
				}

				// DEAKTIVIERT: Master/Slave Status Update Funktion
				// Diese Funktion wurde durch SharingManager.updateAllSyncDisplays() ersetzt
				function updateSyncModeDisplay() {
					// ⚠️ OBSOLET: Diese Funktion wird nicht mehr verwendet
					// Status-Updates erfolgen jetzt zentral über SharingManager
					console.warn(
						"⚠️ updateSyncModeDisplay() ist obsolet - verwende SharingManager.updateAllSyncDisplays()"
					);
					return;
				}

				// Zeit-Update zur zentralen Initialisierung hinzufügen
				window.hangarInitQueue = window.hangarInitQueue || [];
				window.hangarInitQueue.push(function () {
					// Sofort einmal ausführen
					updateTimeDisplay();
					// ENTFERNT: updateSyncModeDisplay() - wird jetzt zentral von SharingManager verwaltet

					// Dann jede Minute aktualisieren (weniger häufig für Zeit ohne Sekunden)
					setInterval(updateTimeDisplay, 60000);

					// ENTFERNT: Event-Listener für Sync-Toggle
					// Toggle-Events werden jetzt direkt vom SharingManager verwaltet
					// const liveSyncToggle = document.getElementById("liveSyncToggle");
					// if (liveSyncToggle) {
					//     liveSyncToggle.addEventListener("change", updateSyncModeDisplay);
					// }

					console.log(
						"⏰ Zeit-Anzeige im Info Widget initialisiert (Sync-Status wird von SharingManager verwaltet)"
					);
				});
			</script>
		</div>

		<!-- Flight Data Status Display -->
		<!-- Toast container -->
		<div id="toast-container" class="toast-container" aria-live="polite" aria-atomic="true"></div>

		<!-- Ensure theme/toggle stay in sync even on BFCache back-navigation -->
		<script>
			(function(){
				function syncThemeAndToggle(){
					try {
						var t = (localStorage.getItem('hangar.theme')||'').toLowerCase();
						var isDark = false;
						if (t === 'dark') isDark = true; else if (t === 'light') isDark = false; else {
							try {
								var raw = localStorage.getItem('displayOptions');
								if (raw) {
									var parsed = JSON.parse(raw);
									if (parsed && parsed.darkMode) isDark = true;
								}
							} catch(e) {}
						}
						// Apply to DOM
						document.documentElement.classList.toggle('dark-mode', isDark);
						if (document.body) document.body.classList.toggle('dark-mode', isDark);
						// Reflect in toggle if present
						var toggle = document.getElementById('darkModeToggle');
						if (toggle) toggle.checked = isDark;
					} catch (e) { /* noop */ }
				}
				// Run on pageshow (covers BFCache), and once after DOM ready as safety
				window.addEventListener('pageshow', syncThemeAndToggle);
				document.addEventListener('DOMContentLoaded', function(){ setTimeout(syncThemeAndToggle, 0); });
			})();
		</script>

		<!-- Persist Export submenu selections across sessions -->
		<script>
			(function () {
				const KEY = "hangarPlanner.exportSettings.v1";

				function readChecked(id) {
					const el = document.getElementById(id);
					return !!(el && el.checked);
				}

				function writeChecked(id, value) {
					const el = document.getElementById(id);
					if (el) el.checked = !!value;
				}

				function loadSettings() {
					try {
						const raw = localStorage.getItem(KEY);
						if (!raw) return null;
						const obj = JSON.parse(raw);
						return obj && typeof obj === "object" ? obj : null;
					} catch (e) {
						console.warn("Export settings parse failed", e);
						return null;
					}
				}

				function saveSettings(settings) {
					try {
						localStorage.setItem(KEY, JSON.stringify(settings));
					} catch (e) {
						console.warn("Export settings save failed", e);
					}
				}

				function collectSettings() {
					return {
						landscapeMode: readChecked("landscapeMode"),
						exportAircraft: readChecked("exportAircraft"),
						exportArrival: readChecked("exportArrival"),
						exportDeparture: readChecked("exportDeparture"),
						exportPosition: readChecked("exportPosition"),
						exportHangarPosition: readChecked("exportHangarPosition"),
						exportStatus: readChecked("exportStatus"),
						exportTowStatus: readChecked("exportTowStatus"),
						exportNotes: readChecked("exportNotes"),
					};
				}

				function applySettings(s) {
					if (!s) return;
					writeChecked("landscapeMode", s.landscapeMode);
					writeChecked("exportAircraft", s.exportAircraft);
					writeChecked("exportArrival", s.exportArrival);
					writeChecked("exportDeparture", s.exportDeparture);
					writeChecked("exportPosition", s.exportPosition);
					writeChecked("exportHangarPosition", s.exportHangarPosition);
					writeChecked("exportStatus", s.exportStatus);
					writeChecked("exportTowStatus", s.exportTowStatus);
					writeChecked("exportNotes", s.exportNotes);
				}

				function attachChangeHandlers() {
					const ids = [
						"landscapeMode",
						"exportAircraft",
						"exportArrival",
						"exportDeparture",
						"exportPosition",
						"exportHangarPosition",
						"exportStatus",
						"exportTowStatus",
						"exportNotes",
					];
					ids.forEach((id) => {
						const el = document.getElementById(id);
						if (el && !el.dataset.exportSettingsListener) {
							el.addEventListener("change", () => saveSettings(collectSettings()));
							el.dataset.exportSettingsListener = "true";
						}
					});
				}

				// Use centralized initialization queue
				window.hangarInitQueue = window.hangarInitQueue || [];
				window.hangarInitQueue.push(function () {
					const saved = loadSettings();
					if (saved) {
						applySettings(saved);
					}
					attachChangeHandlers();
				});

				// Optional: expose helpers for debugging
				window.ExportSettings = {
					load: loadSettings,
					save: saveSettings,
					collect: collectSettings,
					apply: applySettings,
				};
			})();
		</script>

		<script src="js/flight-data-status.js"></script>

		<!-- Minimal fallback: ensure Display Settings defaults and handlers work even if main init didn't run -->
		<script>
		(function(){
			function log(){ try { console.log.apply(console, arguments);} catch(e){} }

			function showPrimaryTiles(count){
				const grid = document.getElementById('hangarGrid');
				if (!grid) return;
				const cells = grid.querySelectorAll('.hangar-cell');
				cells.forEach((cell, idx) => {
					cell.style.display = idx < count ? '' : 'none';
					cell.style.visibility = idx < count ? 'visible' : 'hidden';
				});
			}

			function ensureSecondaryTiles(count, layout){
				const secGrid = document.getElementById('secondaryHangarGrid');
				if (!secGrid) return;
				const current = secGrid.querySelectorAll('.hangar-cell').length;
				if (typeof window.updateSecondaryTiles === 'function'){
					window.updateSecondaryTiles(count, layout || 4);
					return;
				}
				if (window.hangarUI && typeof window.hangarUI.updateSecondaryTiles === 'function'){
					window.hangarUI.updateSecondaryTiles(count, layout || 4);
					return;
				}
				// Manual minimal clone fallback
				if (current < count){
					const template = document.querySelector('#hangarGrid .hangar-cell');
					if (!template) return;
					for (let i=current; i<count; i++){
						const cellId = 101 + i;
						const clone = template.cloneNode(true);
						if (typeof window.updateCellAttributes === 'function'){
							window.updateCellAttributes(clone, cellId);
						}
						clone.querySelectorAll('input, textarea, select').forEach(el => {
							if (el.tagName === 'SELECT') el.selectedIndex = 0;
							else el.value = '';
						});
						secGrid.appendChild(clone);
					}
				}
				// Hide extras if more than count exist
				const cells = secGrid.querySelectorAll('.hangar-cell');
				cells.forEach((cell, idx) => {
					cell.style.display = idx < count ? '' : 'none';
					cell.style.visibility = idx < count ? 'visible' : 'hidden';
				});
			}

			function applyLayoutColumns(layout){
				const updateClasses = (el) => {
					if (!el) return;
					const cls = el.classList;
					for (let i = 1; i <= 12; i++) { cls.remove(`grid-cols-${i}`); }
					cls.add(`grid-cols-${layout}`);
				};
				const apply = (el) => {
					if (!el) return;
					el.style.display = 'grid';
					try {
						el.style.setProperty('grid-template-columns', `repeat(${layout}, minmax(240px, 1fr))`, 'important');
					} catch (e) {
						el.style.gridTemplateColumns = `repeat(${layout}, minmax(240px, 1fr))`;
					}
					updateClasses(el);
				};
				apply(document.getElementById('hangarGrid'));
				apply(document.getElementById('secondaryHangarGrid'));
				try { console.log(`📐 Layout set to ${layout} columns`); } catch(e){}
			}

			function wireControls(){
				const darkToggle = document.getElementById('darkModeToggle');
				if (darkToggle && !darkToggle.__wired){
					darkToggle.addEventListener('change', function(){
						if (this.checked){
							document.body.classList.add('dark-mode');
							document.documentElement.classList.add('dark-mode');
							try { localStorage.setItem('hangar.theme','dark'); } catch(e){}
						} else {
							document.body.classList.remove('dark-mode');
							document.documentElement.classList.remove('dark-mode');
							try { localStorage.setItem('hangar.theme','light'); } catch(e){}
						}
					});
					darkToggle.__wired = true;
				}

				const viewToggle = document.getElementById('viewModeToggle');
				if (viewToggle && !viewToggle.__wired){
					viewToggle.addEventListener('change', function(){
						if (this.checked){
							document.body.classList.add('table-view');
							document.body.classList.remove('tile-view');
						} else {
							document.body.classList.add('tile-view');
							document.body.classList.remove('table-view');
						}
					});
					viewToggle.__wired = true;
				}

				// New: Weather & Time widget toggles (fallback wiring)
				const weatherToggle = document.getElementById('weatherWidgetToggle');
				if (weatherToggle && !weatherToggle.__wired){
					const applyWeather = function(){
						const show = !!weatherToggle.checked;
						document.body.classList.toggle('hide-weather-widget', !show);
						var el = document.getElementById('weather-widget');
						if (el){
							el.classList.toggle('hidden', !show);
							el.style.display = show ? '' : 'none';
							if (show) { el.removeAttribute('hidden'); } else { el.setAttribute('hidden',''); }
						}
					};
					// initial apply
					applyWeather();
					weatherToggle.addEventListener('change', applyWeather);
					weatherToggle.addEventListener('input', applyWeather);
					weatherToggle.__wired = true;
				}

				const timeToggle = document.getElementById('timeWidgetToggle');
				if (timeToggle && !timeToggle.__wired){
					const applyTime = function(){
						const show = !!timeToggle.checked;
						document.body.classList.toggle('hide-time-widget', !show);
						var el = document.getElementById('time-widget');
						if (el){
							el.classList.toggle('hidden', !show);
							el.style.display = show ? '' : 'none';
							if (show) { el.removeAttribute('hidden'); } else { el.setAttribute('hidden',''); }
						}
					};
					applyTime();
					timeToggle.addEventListener('change', applyTime);
					timeToggle.addEventListener('input', applyTime);
					timeToggle.__wired = true;
				}

				const tilesInput = document.getElementById('tilesCount');
				if (tilesInput && !tilesInput.__wired){
					tilesInput.addEventListener('change', function(){
						const v = parseInt(this.value) || 8;
						showPrimaryTiles(v);
					});
					tilesInput.__wired = true;
				}

				const secTilesInput = document.getElementById('secondaryTilesCount');
				if (secTilesInput && !secTilesInput.__wired){
					secTilesInput.addEventListener('change', function(){
						const v = parseInt(this.value) || 4;
						ensureSecondaryTiles(v, parseInt(document.getElementById('layoutType')?.value||'4'));
					});
					secTilesInput.__wired = true;
				}

				const layoutSelect = document.getElementById('layoutType');
				if (layoutSelect && !layoutSelect.__wired){
					layoutSelect.addEventListener('change', function(){
						const v = parseInt(this.value) || 4;
						applyLayoutColumns(v);
						// reflow secondary grid to match layout
						const secCnt = parseInt(document.getElementById('secondaryTilesCount')?.value||'4');
						ensureSecondaryTiles(secCnt, v);
					});
					layoutSelect.__wired = true;
				}
			}

			function fallbackInit(){
				const defaultPrimary = 8;
				const defaultSecondary = 4;
				// defaults in controls
				const tilesInput = document.getElementById('tilesCount');
				if (tilesInput) tilesInput.value = defaultPrimary;
				const secTilesInput = document.getElementById('secondaryTilesCount');
				if (secTilesInput) secTilesInput.value = defaultSecondary;
				const layoutSelect = document.getElementById('layoutType');
				if (layoutSelect) layoutSelect.value = '4';

				// apply visuals
				showPrimaryTiles(defaultPrimary);
				ensureSecondaryTiles(defaultSecondary, 4);
				applyLayoutColumns(4);
				// default view mode
				document.body.classList.add('tile-view');
			}

			// Run after DOM is ready (and also as a setTimeout safety)
			document.addEventListener('DOMContentLoaded', function(){
				try { fallbackInit(); wireControls(); log('✅ Fallback display init applied'); } catch(e){ log('Fallback init error', e); }
			});
			setTimeout(function(){ try { fallbackInit(); wireControls(); } catch(e){} }, 800);
		})();
		</script>
	</body>
</html>
