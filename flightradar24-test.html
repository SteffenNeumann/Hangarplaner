<!DOCTYPE html>
<html lang="de">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Flightradar24 PHP-Proxy Test</title>
		<style>
			body {
				font-family: Arial, sans-serif;
				margin: 20px;
			}
			.test-section {
				margin: 20px 0;
				padding: 15px;
				border: 1px solid #ddd;
				border-radius: 5px;
			}
			.result {
				background: #f9f9f9;
				padding: 10px;
				margin: 10px 0;
				border-radius: 3px;
			}
			.error {
				background: #ffebee;
				color: #c62828;
			}
			.success {
				background: #e8f5e8;
				color: #2e7d32;
			}
			button {
				padding: 10px 15px;
				margin: 5px;
				border: none;
				border-radius: 3px;
				background: #1976d2;
				color: white;
				cursor: pointer;
			}
			button:hover {
				background: #1565c0;
			}
			input {
				padding: 8px;
				margin: 5px;
				border: 1px solid #ddd;
				border-radius: 3px;
			}
			pre {
				background: #f5f5f5;
				padding: 10px;
				overflow-x: auto;
				font-size: 12px;
			}
		</style>
	</head>
	<body>
		<h1>üõ©Ô∏è Flightradar24 PHP-Proxy Test</h1>

		<div class="test-section">
			<h2>Manual Test</h2>
			<div>
				<label>Registrierung:</label>
				<input
					type="text"
					id="testRegistration"
					value="D-AIBN"
					placeholder="z.B. D-AIBN" />

				<label>Datum:</label>
				<input type="date" id="testDate" value="2025-08-07" />

				<label>Endpoint:</label>
				<select id="testEndpoint">
					<option value="history">History</option>
					<option value="aircraft">Aircraft</option>
					<option value="flights">Flights</option>
				</select>

				<button onclick="testProxyManual()">Test Proxy</button>
				<button onclick="testDebugMode()">Debug Mode</button>
			</div>

			<div id="manualResult" class="result" style="display: none"></div>
		</div>

		<div class="test-section">
			<h2>Automatic Tests</h2>
			<button onclick="runAllTests()">Alle Tests ausf√ºhren</button>
			<div id="autoResults"></div>
		</div>

		<div class="test-section">
			<h2>API Integration Test</h2>
			<button onclick="testJavaScriptAPI()">JavaScript API Test</button>
			<div id="jsApiResult" class="result" style="display: none"></div>
		</div>

		<script>
			async function testProxyManual() {
				const registration = document.getElementById("testRegistration").value;
				const date = document.getElementById("testDate").value;
				const endpoint = document.getElementById("testEndpoint").value;

				const resultDiv = document.getElementById("manualResult");
				resultDiv.style.display = "block";
				resultDiv.innerHTML = "<p>üîÑ Testing...</p>";

				try {
					const url = `sync/flightradar24-proxy.php?registration=${registration}&date=${date}&endpoint=${endpoint}`;
					const response = await fetch(url);
					const data = await response.json();

					if (data.success) {
						resultDiv.className = "result success";
						resultDiv.innerHTML = `
                        <h3>‚úÖ Erfolg!</h3>
                        <p><strong>Registrierung:</strong> ${
													data.meta.registration
												}</p>
                        <p><strong>Datum:</strong> ${data.meta.date}</p>
                        <p><strong>Endpoint:</strong> ${data.meta.endpoint}</p>
                        <p><strong>Anzahl Fl√ºge:</strong> ${
													Array.isArray(data.data)
														? data.data.length
														: "Struktur pr√ºfen"
												}</p>
                        <details>
                            <summary>Raw Data anzeigen</summary>
                            <pre>${JSON.stringify(data, null, 2)}</pre>
                        </details>
                    `;
					} else {
						resultDiv.className = "result error";
						resultDiv.innerHTML = `
                        <h3>‚ùå Fehler</h3>
                        <p>${data.error}</p>
                    `;
					}
				} catch (error) {
					resultDiv.className = "result error";
					resultDiv.innerHTML = `
                    <h3>‚ùå Request Fehler</h3>
                    <p>${error.message}</p>
                `;
				}
			}

			async function testDebugMode() {
				const registration = document.getElementById("testRegistration").value;
				const date = document.getElementById("testDate").value;
				const endpoint = document.getElementById("testEndpoint").value;

				const resultDiv = document.getElementById("manualResult");
				resultDiv.style.display = "block";
				resultDiv.innerHTML = "<p>üîç Debug Mode...</p>";

				try {
					const url = `sync/flightradar24-proxy.php?registration=${registration}&date=${date}&endpoint=${endpoint}&debug=1`;
					const response = await fetch(url);
					const data = await response.json();

					resultDiv.className = "result";
					resultDiv.innerHTML = `
                    <h3>üîç Debug Info</h3>
                    <pre>${JSON.stringify(data, null, 2)}</pre>
                `;
				} catch (error) {
					resultDiv.className = "result error";
					resultDiv.innerHTML = `
                    <h3>‚ùå Debug Fehler</h3>
                    <p>${error.message}</p>
                `;
				}
			}

			async function runAllTests() {
				const resultsDiv = document.getElementById("autoResults");
				resultsDiv.innerHTML = "<p>üîÑ Running tests...</p>";

				const tests = [
					{ registration: "D-AIBN", date: "2025-08-07", endpoint: "history" },
					{ registration: "D-AIBN", date: "2025-08-07", endpoint: "aircraft" },
					{ registration: "D-AIBN", date: "2025-08-07", endpoint: "flights" },
					{ registration: "D-AIBL", date: "2025-08-06", endpoint: "history" },
				];

				let results = "<h3>Test Results:</h3>";

				for (let i = 0; i < tests.length; i++) {
					const test = tests[i];
					try {
						const url = `sync/flightradar24-proxy.php?registration=${test.registration}&date=${test.date}&endpoint=${test.endpoint}`;
						const response = await fetch(url);
						const data = await response.json();

						const status = data.success ? "‚úÖ" : "‚ùå";
						const info = data.success
							? `${Array.isArray(data.data) ? data.data.length : "N/A"} items`
							: data.error;

						results += `<div>${status} ${test.registration} (${test.date}, ${test.endpoint}): ${info}</div>`;
					} catch (error) {
						results += `<div>‚ùå ${test.registration} (${test.date}, ${test.endpoint}): ${error.message}</div>`;
					}

					// Kurze Pause zwischen Tests
					await new Promise((resolve) => setTimeout(resolve, 500));
				}

				resultsDiv.innerHTML = results;
			}

			async function testJavaScriptAPI() {
				const resultDiv = document.getElementById("jsApiResult");
				resultDiv.style.display = "block";
				resultDiv.innerHTML = "<p>üîÑ Testing JavaScript API Integration...</p>";

				try {
					// Check if Flightradar24API is available
					if (typeof Flightradar24API === "undefined") {
						throw new Error(
							"Flightradar24API not loaded. Include flightradar24-api.js first."
						);
					}

					const result = await Flightradar24API.getAircraftFlights(
						"D-AIBN",
						"2025-08-07"
					);

					resultDiv.className = "result success";
					resultDiv.innerHTML = `
                    <h3>‚úÖ JavaScript API Test erfolgreich!</h3>
                    <p><strong>Gefundene Fl√ºge:</strong> ${
											result.data.length
										}</p>
                    <details>
                        <summary>Strukturierte Daten anzeigen</summary>
                        <pre>${JSON.stringify(result, null, 2)}</pre>
                    </details>
                `;
				} catch (error) {
					resultDiv.className = "result error";
					resultDiv.innerHTML = `
                    <h3>‚ùå JavaScript API Fehler</h3>
                    <p>${error.message}</p>
                `;
				}
			}

			// Aktuelles Datum als Default setzen
			document.getElementById("testDate").value = new Date()
				.toISOString()
				.split("T")[0];
		</script>
	</body>
</html>
